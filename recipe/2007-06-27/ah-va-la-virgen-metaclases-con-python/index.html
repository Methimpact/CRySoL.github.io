
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ah√≠ va la virgen! Metaclases! (con Python)</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#david_villa">
   david.villa
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/41aae9eabb1ef8e1cb8ab5619af82083?s=48" alt="gravatar"/>

</span>

      </li>
      
      <li>
        <a href="https://twitter.com/david_vi11a" class="twitter-follow-button" data-show-count="false">Follow @david_vi11a</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      </li>
      
      
      <li>
        <span>

Follow on <a title="Follow on G+" href="//plus.google.com/u/0/106836499723740718510?prsrc=3" rel="publisher" target="_top" style="text-decoration:none;">
<img src="//ssl.gstatic.com/images/icons/gplus-16.png" alt="Google+" style="border:0;width:16px;height:16px;"/>

</span>

      </li>
      
    

    <li>created: 2007-06-27 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2007-06-27-ah-va-la-virgen-metaclases-con-python.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2007-06-27-ah-va-la-virgen-metaclases-con-python.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/600">node/600</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#Python-ref">Python</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#Python-ref">
        <img src="http://crysol.org/files/category_pictures/python.png" title="Python" alt="Python-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>

  <ul>
   
   
      
        
          
          <li><a href="/recipe/2013-06-07/testing-deterministic-behavior-with-doublex">Testing deterministic behavior with doublex</a></li>
        
      
        
          
          <li><a href="/recipe/2013-02-27/instalar-un-mdulo-python-en-un-virtualenv">Instalar un m√≥dulo Python en un virtualenv</a></li>
        
      
        
          
          <li><a href="/recipe/2012-10-26/asyncronous-spy-assertions-with-python-doublex"> Asyncronous spy assertions with python-doublex</a></li>
        
      
        
          
          <li><a href="/2012-10-03/distribuyendo-programas-python-en-el-pypi-python-package-index">Distribuyendo programas Python en el PyPI (Python Package Index)</a></li>
        
      
        
          
          <li><a href="/recipe/2011-08-21/stdeb-o-cmo-crear-paquetes-debian-de-mdulos-python-como-churros">stdeb, o c√≥mo crear paquetes debian de m√≥dulos Python como churros</a></li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
   
  </ul>

  
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2014-11-11/schroot-snapshots">schroot: snapshot chroots</a></li>
  
    <li><a href="/recipe/2014-10-08/introduction-to-ogre3d">Introduccion a Ogre3D</a></li>
  
    <li><a href="/recipe/2014-09-28/nautilus-sort-directories-first">nautilus: list folder before files</a></li>
  
    <li><a href="/recipe/2014-05-27/vagrant-multi-machine">multi machine Vagrantfile</a></li>
  
    <li><a href="/recipe/2014-05-20/veewee-on-debian">Installing veewee on Debian sid</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Ah√≠ va la virgen! Metaclases! (con Python) </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote class="head">
<p class="head">Esta receta es una peque√±a introducci√≥n a la meta-programaci√≥n, concretamente voy a contar algunas cosillas sobre uno de los mecanismos m√°s populares y potentes: las metaclases.</p>
</blockquote>
<p><!--break--></p>
<h2>Introducci√≥n</h2>
<p>¬øQu√© es una metaclase? Pues es una clase cuyas instancias son clases en lugar de objetos. Es decir, si para construir un objeto usas una clase, para construir una clase usas una metaclase.</p>
<p>¬øY eso para qu√© sirve? Pues resulta muy √∫til principalmente para dos cosas:</p>
<ul>
	<li>Cuando no sea posible determinar el tipo de un objeto hasta el momento de la ejecuci√≥n del programa, o cuando sea necesario crear una clase a la medida de las circunstancias. Se podr√≠a decir que en este caso la metaclase funciona como una &#8220;f√°brica de clases&#8221; especializada.</li>
	<li>Cuando se desea componer o modificar el comportamiento o caracter√≠sticas de una clase en el momento de su creaci√≥n por medio de herencia o por mecanismos de construcci√≥n din√°micos. Es algo parecido a la <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">Programaci√≥n Orientada a Aspectos</a> o como una generalizaci√≥n del <a href="http://en.wikipedia.org/wiki/Decorator_pattern">patr√≥n decorator</a>.</li>
</ul>
<p><strong>Nota:</strong> Aunque es perfectamente posible (aunque doloroso) crear metaclases con &#8220;clases cl√°sicas&#8221;, en esta receta me voy a centrar √∫nicamente en el uso de clases del &#8220;nuevo-estilo&#8221;, aunque ya no son muy  nuevas que digamos; aparecieron en Python 2.1. Si no sabes de qu√© estoy hablando lee <a href="http://docs.python.org/ref/node33.html">New-style and classic classes</a>.</p>
<h2>Requisitos</h2>
<p>Para que puedas sacarle todo el juego a esta receta necesitas:</p>
<ul>
	<li>Tener claros conceptos t√≠picos de orientaci√≥n a objetos: herencia, encapsulaci√≥n, polimorfismo, etc</li>
	<li>Tener unas nociones sobre patrones de dise√±o</li>
	<li>Tener una buena base de Python y sus mecanismos de introspecci√≥n</li>
	<li>Probar t√∫ mismo los ejemplos que aparecen aqu√≠</li>
</ul>
<p>No voy a tratar aqu√≠ todo lo que se puede hacer con metaclases (ser√≠a una tarea tit√°nica). Mi objetivo es que esta receta sirva para entender las bases del invento y poder enfrentarse con una base s√≥lida a la literatura sobre metaclases que se puede encontrar por ah√≠, por ejemplo en la secci√≥n <a href="#referencias">Referencias</a> de esta misma receta.</p>
<p>Hay un cierto elitismo que rodea a todo esto de la metaprogramaci√≥n y que me fastidia bastante. La mayor√≠a de lo que puedes encontrar por Internet relacionado con este tema da por hecho que no te vas a enterar absolutamente de nada. Mi intenci√≥n con esta receta es demostrar que no es algo tan dif√≠cil (n√≥tese la iron√≠a del t√≠tulo de la receta) y que est√° al alcance de cualquier programador inquieto. Juzga t√∫ si he conseguido mi prop√≥sito.</p>
<h2>Un problema</h2>
<p>Imagina que tienes un conjunto de clases:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">print</span> <span class="s">&#39;a&#39;</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">print</span> <span class="s">&#39;b&#39;</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">Z</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">print</span> <span class="s">&#39;z&#39;</span></code></pre></div></div>
<p>Y tu programa debe crear un objeto de una de esas clases, pero lo que determina qu√© clase instanciar es un dato introducido por el usuario. En principio, las dos alternativas para implementar eso que se le pueden ocurrir a uno a bote pronto no pintan demasiado bien:</p>
<ul>
	<li>Una estructura de selecci√≥n m√∫ltiple &#8220;if elif&#8221; monstruosa.</li>
	<li>Un diccionario en el que las claves son nombres de clase y los valores son las propias clases. Es decir, algo como:</li>
</ul>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">clases</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="n">B</span><span class="p">,</span> <span class="o">...</span> <span class="s">&#39;Z&#39;</span><span class="p">:</span><span class="n">Z</span><span class="p">}</span>
<span class="n">instancia</span> <span class="o">=</span> <span class="n">clases</span><span class="p">[</span><span class="n">tipo</span><span class="p">]()</span></code></pre></div></div>
<p>Esto funciona bien cuando no necesitas manejar herencia, simplemente quieres elegir qu√© clase instanciar. Sin embargo, Python dispone de una forma de construir y ejecutar c√≥digo din√°micamente dentro de un programa, usando la funci√≥n <code>exec()</code>. As√≠ que podr√≠as hacer:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">exec</span> <span class="s">&#39;clase = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tipo</span>   <span class="c"># siendo &#39;tipo&#39; el nombre de una clase</span>
<span class="n">instancia</span> <span class="o">=</span> <span class="n">clase</span><span class="p">()</span></code></pre></div></div>
<p>Y esto realmente ya es metaprogramaci√≥n, pero sigue sin ser suficiente si lo que quieres es crear realmente una clase nueva y no s√≥lo elegir entre ciertas clases ya existentes. Usar <code>exec()</code> para cosas m√°s sofisticadas que ese ejemplo resulta confuso y potencialmente problem√°tico, aunque tambi√©n es uno de los mecanismos de metaprogramaci√≥n m√°s potentes en Python, por razones obvias.</p>
<h2>type, la madre de todas las metaclases</h2>
<p>A partir de Python 2.2 <code>type()</code> tiene un significado nuevo muy especial: permite crear nuevos tipos, es decir, es una metaclase, de hecho es la metaclase con la que est√°n creados todos los tipos &#8220;built-in&#8221; de Python y todas las clases de &#8220;nuevo-estilo&#8221; (las que heredan de <code>object</code>); como ya he dicho, obviar√© las &#8220;clases cl√°sicas&#8221;.</p>
<p>Para crear una clase con <code>type()</code> se usa la siguiente sintaxis:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span></code></pre></div></div>
<ul>
	<li><strong>name</strong>: es el nombre de la nueva clase</li>
	<li><strong>bases</strong>: son las clases de las que hereda</li>
	<li><strong>dct</strong>: es un diccionario con los m√©todos que implementa</li>
</ul>
<p>Por ejemplo, puedes crear una nueva clase llamada <code>Saludo</code> que implementa un m√©todo <code>hola()</code> simplemente con:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Saludo</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;Saludo&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s">&#39;hola&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="s">&#39;hola metamundo!&#39;</span><span class="p">})</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Saludo</span><span class="p">()</span>
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">hola</span><span class="p">()</span></code></pre></div></div>
<p>Y de hecho, cualquier sentencia <code>class</code> de las que has usado hasta ahora implica realmente una invocaci√≥n similar, puesto que <code>type</code> es la metaclase impl√≠cita cuando defines clases &#8220;normales&#8221;. Sin embargo, en el ejemplo anterior, <code>type</code> no se usa como metaclase; se emplea simplemente como &#8220;factor√≠a de clases&#8221; puesto que se invoca como una funci√≥n (o al menos, es lo que parece). Es decir, salvando las distancias, es algo equivalente a:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">class_factory</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
   <span class="k">class</span> <span class="nc">retval</span><span class="p">:</span> <span class="k">pass</span>
   <span class="nb">setattr</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">retval</span>

<span class="k">def</span> <span class="nf">hola</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="k">return</span> <span class="s">&#39;hola a todos!&#39;</span>

<span class="n">SaludoClass</span> <span class="o">=</span> <span class="n">class_factory</span><span class="p">(</span><span class="n">hola</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">SaludoClass</span><span class="p">()</span>  
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">hola</span><span class="p">()</span></code></pre></div></div>
<p>Pero <code>type</code> no es una funci√≥n, es una <strong>metaclase</strong> (una clase) y por tanto se puede heredar de ella. Y como <code>type</code> es una metaclase: <strong>cualquier subclase de <code>type</code> ES una metaclase</strong>;  y aqu√≠ es d√≥nde la cosa se pone interesante :-)</p>
<h2>Antes de seguir: __new__ e __init__</h2>
<p><code>__new__</code> e <code>__init__</code> son dos de los m√©todos especiales que tienen todas las clases. Es muy habitual que el programador escriba un m√©todo <code>__init__</code> para sus clases (tanto que ni siquiera voy a poner un ejemplo). Este m√©todo se ejecuta despu√©s de construirse la instancia y se utiliza para inicializar los atributos que lo requieran y, en general, hacer trabajo de &#8220;setup&#8221; de la instancia.</p>
<p>El uso de <code>__new__</code> es mucho menos frecuente, hasta el punto de que muchos programadores con muchas horas de vuelo en Python nunca lo han usado. <code>__new__</code> es el verdadero &#8220;constructor&#8221;, es el encargado de crear la instancia y proporcionarle una ubicaci√≥n en memoria.</p>
<p><code>__new__</code> es un m√©todo peculiar. Es est√°tico (<code>staticmethod</code>), es decir, existe con independencia de las instancias de la clase y por tanto no tiene un argumento <code>self</code>. En su lugar, lo que se le pasa como argumento es la propia clase, normalmente nombrado como <code>cls</code>.</p>
<p>El proceso de creaci√≥n de un objeto (instancia) de una clase es m√°s o menos as√≠ (despu√©s lo refinamos):</p>
<ul>
	<li>Se <em>invoca la clase</em> con los argumentos requeridos</li>
	<li>Se ejecuta el m√©todo <code>__new__</code> pas√°ndose la clase a s√≠ misma como primer argumento, y a continuaci√≥n los argumentos que indic√≥ el usuario en la &#8220;invocaci√≥n&#8221; original.</li>
	<li><code>__new__</code> retorna una nueva instancia (esto es obligatorio).</li>
	<li>Se ejecuta el m√©todo <code>__init__</code> pasando como primer argumento la instancia creada por <code>__new__</code> y tambi√©n todos los argumentos de la invocaci√≥n original.</li>
</ul>
<p>Despu√©s veremos que en realidad todo esto est√° orquestado por la metaclase.</p>
<h2>Escribiendo un m√©todo __new__</h2>
<p>Como ejemplo, esta es una clase que formatea una cadena como t√≠tulo (pone en may√∫scula la primera letra de cada palabra). Lo interesante es que esta clase ES <span class="caps">UNA</span> cadena, es decir, hereda del tipo predefinido <code>str</code>:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Title</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<span class="o">...</span>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="o">...</span>       <span class="k">print</span> <span class="s">&#39;construyendo un nuevo objeto&#39;</span>
<span class="o">...</span>       <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">Title</span><span class="p">(</span><span class="s">&#39;transparencias adi√≥s&#39;</span><span class="p">)</span>
<span class="n">construyendo</span> <span class="n">un</span> <span class="n">nuevo</span> <span class="n">objeto</span>
<span class="s">&#39;Transparencias Adi√≥s&#39;</span></code></pre></div></div>
<p>Aunque sea un ejemplo muy simple y no tenga mucha utilidad, demuestra la forma en que se construye el objeto y permite algo que no puede hacerse de otro modo; puede decidir el valor de un objeto de tipo inmutable (como es <code>str</code>) en el √∫nico momento en que es posible: su creaci√≥n. Si quieres, puedes comprobar que esto no se puede hacer utilizando <code>__init__</code>.</p>
<p>La sentencia <code>return</code> invoca directamente el m√©todo <code>__new__</code> de la superclase porque √©se es el √∫nico modo de conseguir una creaci√≥n limpia, es decir, evitando que se ejecute el m√©todo <code>__init__</code> de la superclase. Para este ejemplo, lo podr√≠as cambiar por:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">title</span><span class="p">()</span></code></pre></div></div>
<p>y funcionar√° igual, porque el m√©todo <code>__init__</code> de <code>str</code> no hace ni puede hacer nada relevante sobre la instancia. Pero para clases m√°s complejas, construir la instancia de ese modo en lugar de usar <code>__new__</code> puede tener efectos no deseables.</p>
<h2>Tu primera metaclase</h2>
<p>La metaclase m√°s simple (y m√°s in√∫til) que se puede escribir es algo como:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">MyMetaclase</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
   <span class="k">pass</span></code></pre></div></div>
<p>Es decir, no es m√°s que un &#8220;alias&#8221; de <code>type</code> y por tanto hereda todos sus m√©todos. Ahora a√±ade un m√©todo a la metaclase, llamado por algunos &#8216;metam√©todo&#8217;. Yo no estoy de acuerdo con esa denominaci√≥n, porque siendo puristas un metam√©todo ser√≠a <em>un m√©todo de un m√©todo</em> (que los hay: <code>str.lower.__call__</code>) pero esto es solo un m√©todo de una metaclase, que poco tiene que ver.</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">MyMetaclase2</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="o">...</span>    <span class="k">def</span> <span class="nf">habla</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
<span class="o">...</span>       <span class="k">print</span> <span class="s">&#39;m√©todo de la clase&#39;</span><span class="p">,</span> <span class="n">cls</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">MyMetaclase2</span><span class="o">.</span><span class="n">habla</span><span class="p">()</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unbound</span> <span class="n">method</span> <span class="n">habla</span><span class="p">()</span> <span class="n">must</span> <span class="n">be</span> <span class="n">called</span> <span class="k">with</span> <span class="n">MyMetaclase2</span> <span class="n">instance</span> <span class="k">as</span> <span class="n">first</span> <span class="n">argument</span> <span class="p">(</span><span class="n">got</span> <span class="n">nothing</span> <span class="n">instead</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span> <span class="o">=</span> <span class="n">MyMetaclase2</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">habla</span><span class="p">()</span>
<span class="n">m</span><span class="err">√©</span><span class="n">todo</span> <span class="n">de</span> <span class="n">la</span> <span class="n">clase</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">A</span><span class="s">&#39;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span> <span class="c"># una instancia de la clase A</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a1</span><span class="o">.</span><span class="n">habla</span><span class="p">()</span>
<span class="s">&#39;A&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">&#39;habla&#39;</span></code></pre></div></div>
<p>De los dos primeros intentos de ejecutar el m√©todo <code>habla()</code> se puede concluir que para que un m√©todo definido en la metaclase pueda ser invocado se requiere de una instancia (una clase); eso no resulta sorprendente, es lo mismo que ocurre con los m√©todos normales en las clases normales.</p>
<p>Y del tercer intento se deduce que las instancias de las clases creadas con la metaclase no tienen acceso a los m√©todos definidos en la metaclase. O sea, los m√©todos definidos en la metaclase son <strong>para las clases</strong> creadas con la metaclase. Es algo parecido a definir ese m√©todo en la clase A usando el decorador <code>@classmethod</code>; la diferencia m√°s importante es que con el m√©todo de clase (<code>@classmethod</code>), las subclases de A heredan el m√©todo, sin embargo, con el c√≥digo del ejemplo no ocurre.</p>
<h2>La vuelta de tuerca</h2>
<p>Despu√©s de estos preliminares, puedes empezar a atar cabos. Si cuando hablamos de clases, <code>__new__</code> sirve para crear instancias e <code>__init__</code> sirve para inicializar/modificar instancias&#8230; cuando hablemos de metaclases:</p>
<ul>
	<li><code>__new__</code> sirve para <strong>crear clases</strong></li>
	<li><code>__init__</code> sirve para <strong>inicializar/modificar clases</strong></li>
</ul>
<p>Es decir, los dos usos principales de las metaclases que vimos en la introducci√≥n. Eso no significa que estos sean los dos √∫nicos m√©todos interesantes de las metaclases.</p>
<p>Lo interesante aqu√≠ es que, &#8220;modificar una clase&#8221; incluye cosas como a√±adir o modificar m√©todos, sus implementaciones, sus nombres, argumentos y n√∫mero, atributos, etc, etc, las posibilidades son infinitas.</p>
<p>Empieza por redefinir <code>__init__</code> y <code>__new__</code> invocando a los m√©todos de la superclase. Esto tampoco es que sea una maravilla, pero sirve para que veas cuando se ejecuta cada cosa y puedas comprobar que lo que dije antes sobre <code>__new__</code> e <code>__init__</code> para clases tambi√©n funciona con metaclases (ser√° porque las metaclases son clases ;-))</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">MyMetaclase3</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">print</span> <span class="s">&#39;Creando la clase&#39;</span><span class="p">,</span> <span class="n">name</span>
<span class="o">...</span>         <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">print</span> <span class="s">&#39;Inicializando la clase&#39;</span><span class="p">,</span> <span class="n">name</span>
<span class="o">...</span>         <span class="nb">type</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">MyMetaclase3</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{})</span>
<span class="n">Creando</span> <span class="n">la</span> <span class="n">clase</span> <span class="n">X</span>
<span class="n">Inicializando</span> <span class="n">la</span> <span class="n">clase</span> <span class="n">X</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">X</span><span class="p">()</span> <span class="c"># y por supuesto, puedes crear instancias de la clase X</span></code></pre></div></div>
<p>Ya toca escribir una metaclase que haga algo √∫til por poco que sea. Esta metaclase crea autom√°ticamente m√©todos que se llaman &quot;not_[m√©todo]&#8217; para cada m√©todo de la clase. Estos m√©todos devuelven el valor l√≥gico negado de la funci√≥n original.</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">types</span>

<span class="k">class</span> <span class="nc">AutoNot</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
       <span class="nb">type</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
       <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)]</span> 
       <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
           <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;not_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">m</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="ow">not</span> <span class="n">dct</span><span class="p">[</span><span class="n">m</span><span class="p">](</span><span class="bp">self</span><span class="p">))</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">AutoNot</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s">&#39;yes&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span><span class="bp">True</span><span class="p">})</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>

<span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">yes</span><span class="p">()</span>
<span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">not_yes</span><span class="p">()</span></code></pre></div></div>
<h2>Un poco de az√∫car sint√°ctico</h2>
<p>Supongo que eso de crear clases pasando el nombre, la lista de clases base y el diccionario de m√©todos te parecer√° tan ortop√©dico como a m√≠. No hay problema, afortunadamente hay una forma mucho m√°s estilosa de usar una metaclase. Consiste en usar un atributo de clase especial llamado <code>__metaclass__</code> y asignarle la metaclase que quieras usar para crear esa clase. Lo siguiente es equivalente al ejemplo anterior pero modificado para usar <code>__metaclass__</code>:</p>
<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">types</span>

<span class="k">class</span> <span class="nc">AutoNot</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
       <span class="nb">type</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
       <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)]</span> 
       <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
           <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;not_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">m</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="ow">not</span> <span class="n">dct</span><span class="p">[</span><span class="n">m</span><span class="p">](</span><span class="bp">self</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">AutoNot</span>
    
    <span class="k">def</span> <span class="nf">yes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>

<span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">yes</span><span class="p">()</span>
<span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">not_yes</span><span class="p">()</span></code></pre></div></div>
<h2>Ejemplos</h2>
<ul>
	<li><a href="/node/1017">Patr√≥n Singleton como metaclase</a></li>
	<li><a href="/node/1278">Patr√≥n Flyweight en Python como metaclase</a></li>
	<li><a href="/node/1018">Invocaci√≥n autom√°tica del &#8216;constructor&#8217; de la superclase</a></li>
</ul>
<p><a name="referencias"> </a></p>
<h2>Referencias</h2>
<p>Los ejemplos de esta receta est√°n fuertemente inspirados en las referencias que cito a continuaci√≥n. He tratado de simplificarlos para hacerlos m√°s accesibles al programador Python novato. Es muy probable que en el proceso de &#8220;simplificaci√≥n&#8221; haya metido la pata y tengan alg√∫n que otro error gordo, por favor, h√°zmelo saber con un comentario.</p>
<ul>
	<li><a href="http://">Unifying types and classes in Python 2.2</a><a href="http://www.python.org/download/releases/2.2.3/descrintro/">www.python.org/download/releases/2.2.3/descrintro/</a></li>
	<li><a href="http://">A Primer on Python Metaclass Programming</a><a href="http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html">www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html</a></li>
	<li><a href="http://">Meta-classes Made Easy</a><a href="http://www.voidspace.org.uk/python/articles/metaclasses.shtml">www.voidspace.org.uk/python/articles/metaclasses.shtml</a></li>
	<li><a href="http://www-128.ibm.com/developerworks/linux/library/l-pymeta.html">Metaclass programming in Python</a> | <a href="http://www-128.ibm.com/developerworks/library/l-pymeta2/"><sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup></a></li>
	<li><a href="http://">Python Metaclasses: Who? Why? When?</a><a href="http://www.python.org/pycon/dc2004/papers/24/metaclasses-pycon.pdf">www.python.org/pycon/dc2004/papers/24/metaclasses-pycon.pdf</a></li>
	<li><a href="http://groups.google.com/group/comp.lang.python/browse_frm/thread/8162be7311142725/14e158b5e88b3869#14e158b5e88b3869">comp.lang.python</a></li>
	<li><a href="http://blogs.gnome.org/view/johan/2007/04/09/0">Metaclasses &amp; PyGObject</a></li>
	<li><a href="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/102187">Singleton as a metaclass</a></li>
	<li><a href="http://www.cafepy.com/">http://www.cafepy.com/</a></li>
</ul>
<ul>
	<li><a href="http://www.garyrobinson.net/2004/03/python_singleto.html">http://www.garyrobinson.net/2004/03/python_singleto.html</a></li>
	<li><a href="http://groups.google.com/group/comp.lang.python/browse_thread/thread/bbf837b828987150/7c8cd3c8e17e1814">http://groups.google.com/group/comp.lang.python/browse_thread/thread/bbf837b828987150/7c8cd3c8e17e1814</a></li>
</ul>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2007-06-26/solucin-al-fallo-de-glx-en-tarjetas-nvidia-antiguas-legacy" title="Soluci√≥n al fallo de GLX en tarjetas Nvidia antiguas (legacy)">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/2007-06-27/metaclase-para-invocacin-automtica-del-constructor-de-la-superclase" title="Metaclase para invocaci√≥n autom√°tica del "constructor" de la superclase">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2014 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/web.source" target="_blank">site sources</a>.
	  <br/>
	  Generated at 2014-11-11 12:22:32 +0100
	</p>
      </footer>

    </div>

    
  </body>
</html>

