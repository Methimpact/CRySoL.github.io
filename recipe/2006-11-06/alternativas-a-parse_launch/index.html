
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Alternativas a parse_launch()</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#oscarah">
   oscarah
  </a>


        
        <span class="author-photo">

  
    <img src="/assets/files/pictures/picture-111.gif" width="48" alt="picture"/>
  

</span>

      </li>
      
    

    <li>created: 2006-11-06 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2006-11-06-alternativas-a-parse_launch.html">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2006-11-06-alternativas-a-parse_launch.html">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/433">node/433</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#gstreamer-ref">gstreamer</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#gstreamer-ref">
        <img src="http://crysol.org/files/category_pictures/gstreamer.png" title="gstreamer" alt="gstreamer-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Convert .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
    <li><a href="/recipe/2013-07-10/get-shell-user-without-shell">How to get a shell for a non-shell user</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Alternativas a parse_launch() </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	Llegados a este punto, sabemos como crear una pequeña aplicación, bastante sencilla, que use Gstreamer para las tareas multimedia (evidentemente, doy por hecho que has leido el mini-tutorial que dejé. Si todavía no lo has leido, y no sabes de que estoy hablando... ¡a que esperas!).

<!--break-->


<h3>gst.parse_launch()</h3>
Cuando creamos la tubería, usamos una función de la API de gstreamer llamada <code>parse_launch().</code> Esta se encargaba de leer una descripción de la tubería que queríamos y la creaba para nosotros. Es una forma muy rápida de probar combinaciones de elementos y además nos permite introducirnos en el mundo de Gstreamer sin tener que preocuparnos por los Elementos o los enlaces entre estos. Esta utilidad (que además esta disponible para ejecutar desde la línea de comandos, cosa que pronto veremos) tiene sus limitaciones, evidentemente. Para nuestro propósito, que es docente, la mayor limitación es que nos oculta la estructura interna de la tubería. Así pues, si queremos analizarla tomando los elementos que la forman, sus enlaces, etc. tendremos que hacerla de otro modo. Aquí es donde entran en juego las alternativas a <code>parse_launch()</code>

<h3>gst.element_factory_make()</h3>
Seguro que recordarás que cada elemento puede poseer uno o más pads, es decir, uno o más 'enchufes'. También se dijo que era usual que se crearan los pads solo cuando eran necesarios, los cuales llamamos pads dinámicos. Pues bien, cuando creamos una tubería y deseamos especificar los elementos que la forman uno a uno, debemos conectar estos pads entre sí para que el flujo de datos sea posible.

Teniendo esto presente, vamos a definir nuestra tubería. Primero creamos un contenedor, cuya función será almacenar el resto de elementos y controlar el flujo que pase por ellos, es decir, manipulará el estado de la tubería entera. Luego el resto de elementos. La cadena que definía la tubería era: <code>"filesrc location=' + args[1] + ' ! oggdemux ! vorbisdec ! audioconvert ! alsasink"</code>. Es decir, que usamos lo siguiente: filesrc, oggdemux, vorbisdec, audioconvert y alsasink. Anteriormente ya describimos estos elementos. Ahora los vamos a crear uno a uno usando <code>element_factory_make().</code> Esta función admite dos argumentos, uno obligatorio y otro opcional. El primero de ellos (obligatorio) indica el plugin que queremos usar en ese elemento (como 'filesrc' u 'oggdemux') y el segundo especifica un nombre para el elemento. Como es opcional, si no lo ponemos, gstreamer le asigna uno por defecto (de la forma 'nombre_del_pluginN', siendo N un número). Este nombre ha de ser único, pues debe identificar el elemento de forma unívoca. Para nuestro ejemplo, el código sería así:


<div>
<div class="highlight"><pre><code class="python"><span class="n">pipeline</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span><span class="s">&#39;pipeline&#39;</span><span class="p">)</span>
<span class="n">filesrc</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;filesrc&quot;</span><span class="p">,</span> <span class="s">&quot;file-src&quot;</span><span class="p">)</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;oggdemux&quot;</span><span class="p">,</span><span class="s">&quot;ogg-parser&quot;</span><span class="p">)</span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;vorbisdec&quot;</span><span class="p">,</span><span class="s">&quot;vorbis-decoder&quot;</span><span class="p">)</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;audioconvert&quot;</span><span class="p">,</span><span class="s">&quot;converter&quot;</span><span class="p">)</span>
<span class="n">sink</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;alsasink&quot;</span><span class="p">,</span> <span class="s">&quot;alsa-sink&quot;</span><span class="p">)</span>
</code></pre></div>
</div>

Con eso, creamos los elementos. Estos elementos hacen uso de algunos plugins disponibles en gstreamer. Es muy común que estos plugins sean configurables, es decir, que podamos modificar o establecer algunas de sus propiedades o atributos. ¿Como? Pues, la mayoría de las veces, existe un método llamado <code>set_property()</code> (que a los programadores de glib seguro que les suena) que se encarga de ello. Acepta dos argumentos: uno con el nombre de la propiedad que queremos modificar y el otro con el valor nuevo que queremos darle. En este caso, hemos creado un 'filesrc', que lee de un fichero del disco. Evidentemente, hemos de especificar donde está el fichero del que leer. Esto lo hacemos así:


<div>
<div class="highlight"><pre><code class="python"><span class="n">filesrc</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>
</div>

De momento, no necesitamos modificar ningún atributo más. Así que ya tenemos nuestros elementos creados y configurados. Nuestro siguiente paso, antes de hacer nada más, es meterlos en el contenedor que hemos creado:


<div>
<div class="highlight"><pre><code class="python"><span class="nb">bin</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filesrc</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="n">conv</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</code></pre></div>
</div>

Y ahora, lo que nos queda es hacer un camino para el flujo de datos, es decir, establecer enlaces entre ellos. Como anteriormente explicamos, los pads tienen definida la dirección del flujo: existen pads del tipo 'src' o fuente, que son los que aportan datos; y existen pads del tipo 'sink' o sumidero, que son los que reciben datos. Así pues, cuando creamos un filesrc, este elemento solo tiene un pad, de tipo src, lo cual nos indica que nos aportará datos a la tubería (como esperábamos). ¿Como conectamos los pads? Es muy simple: un pad de tipo fuente debe conectarse a un pad de tipo sumidero. Los datos que aporte la fuente irán a parar al sumidero. Pues bien, en nuestro caso, tanto oggdemux y vorbisdec como audioconvert tienen (o tendrán) pads de los dos tipos. Solo tenemos que conectarlos en ese orden y listo. Para ello, usamos la función <code>gst.element_link_many()</code>. Acepta desde dos hasta un número indefinido de parámetros, pero todos ellos son elementos que enlazar. Y los enlaza en el órden que le demos. Por tanto, lo lógico sería usar:

<font color="red"><b>gst.element_link_many(filesrc, parser, decoder, conv, sink)</b></font>

pero si intentamos esto, seguro que se producirá un error, avisandonos de que no es posible enlazar el ogg-parser con el vorbis-decoder. ¿Por qué? La razón es bien sencilla. El oggdemux no tiene un pad del tipo src. O por lo menos no lo tiene de momento. El src de este elemento es dinámico, como antes explicábamos. Solo se creará cuando sea necesario. ¿Por qué existen estos pads? Porque el Ogg no es más que un envoltorio para diferentes tipos de datos: audio, video, etc. Como, teóricamente, pueden existir muchos tipos de datos encapsulados, no sería apropiado crear un src para cada tipo de datos si sólo queremos usar uno de ellos. Sucede lo mismo con otros envoltorios, así que es común la existencia de pads dinámicos. Lo que nos interesa ahora es cómo lo solucionamos. También es muy sencillo: creamos una función que sea llamada cuando se cree ese nuevo pad y que se encargue de enlazarlo de forma adecuada. ¿Cómo podemos saber que se ha creado un nuevo pad? Cuando un elemento crea un nuevo pad, se produce un evento que podemos capturar, es decir, gstreamer nos avisa de que se ha creado un nuevo pad y nosotros podemos decirle a gstreamer que cuando esto ocurra, sea llamada nuestra función. Esto lo hacemos usando el método <code>connect()</code>, que <i>'conecta'</i> el evento con nuestra función. Pero antes, debemos crear la función:


<div>
<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">new_pad</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">pad</span><span class="p">):</span>
    <span class="n">sinkpad</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">get_pad</span><span class="p">(</span><span class="s">&quot;sink&quot;</span><span class="p">)</span>
    <span class="n">pad</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sinkpad</span><span class="p">)</span>
</code></pre></div>
</div>

Esta función acepta dos parámetros: el primero es una referencia al elemento que la llama y el segundo es el nuevo pad que se ha creado. Ahora solo tenemos que enlazarlo con el sink correspondiente, que para nuestro caso es el del decoder. Lo obtenemos con el método <code>get_pad()</code> al cual le pasamos el tipo de pad que queremos, 'sink'. Por último, enlazamos el nuevo pad, que será de tipo 'src' con el 'sink' que obtenemos del decoder.

Bien, ahora que tenemos la función, podemos conectar el evento correspondiente a esta función con <code>connect()</code> Este método acepta dos argumentos: el evento que se produce y la función a la que lo enlazamos:


<div>
<div class="highlight"><pre><code class="python"><span class="n">parser</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;pad-added&quot;</span><span class="p">,</span> <span class="n">new_pad</span><span class="p">)</span>
</code></pre></div>
</div>

Por último, tenemos que enlazar el resto de elementos, que tienen pads estáticos. Lo hacemos asi:



<div>
<div class="highlight"><pre><code class="python"><span class="n">gst</span><span class="o">.</span><span class="n">element_link_many</span><span class="p">(</span><span class="n">filesrc</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
<span class="n">gst</span><span class="o">.</span><span class="n">element_link_many</span><span class="p">(</span><span class="n">decoder</span><span class="p">,</span> <span class="n">conv</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</code></pre></div>
</div>


<h3>Conclusión</h3>
Y...¡ya esta! Ahora, en bin tenemos algo homólogo a si hubiéramos usado <code>parse_launch().</code> Entoces... ¿por qué liarse tanto? En primer lugar, porque, como antes comenté, así vemos un poco más profundamente como es una tubería en gstreamer. Por otro lado, porque con <code>parser_launch()</code> solo podemos crear elementos que ya estén registrados en gstreamer. Si creamos un nuevo elemento que no sea estándar (cosa que haremos más tarde), no podremos usar <code>parse_launch()</code> (al menos no sin complicar un poco las cosas).


<h3>Código</h3>


<div>
<div class="highlight"><pre><code class="python"><span class="c"># -*- coding: latin -*-</span>

<span class="kn">import</span> <span class="nn">pygst</span>
<span class="n">pygst</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="s">&quot;0.10&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">gst</span><span class="o">,</span> <span class="nn">gobject</span>
<span class="n">gobject</span><span class="o">.</span><span class="n">threads_init</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Uso:&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;archivo.ogg&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

  <span class="n">pipeline</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span><span class="s">&#39;pipeline&#39;</span><span class="p">)</span>

  <span class="n">filesrc</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;filesrc&quot;</span><span class="p">,</span> <span class="s">&quot;file-src&quot;</span><span class="p">)</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;oggdemux&quot;</span><span class="p">,</span><span class="s">&quot;ogg-parser&quot;</span><span class="p">)</span>
  <span class="n">decoder</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;vorbisdec&quot;</span><span class="p">,</span><span class="s">&quot;vorbis-decoder&quot;</span><span class="p">)</span>
  <span class="n">conv</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;audioconvert&quot;</span><span class="p">,</span><span class="s">&quot;converter&quot;</span><span class="p">)</span>
  <span class="n">sink</span> <span class="o">=</span> <span class="n">gst</span><span class="o">.</span><span class="n">element_factory_make</span><span class="p">(</span><span class="s">&quot;alsasink&quot;</span><span class="p">,</span> <span class="s">&quot;alsa-sink&quot;</span><span class="p">)</span>

  <span class="n">filesrc</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">new_pad</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">pad</span><span class="p">):</span>
    <span class="n">sinkpad</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">get_pad</span><span class="p">(</span><span class="s">&quot;sink&quot;</span><span class="p">)</span>
    <span class="n">pad</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sinkpad</span><span class="p">)</span>

  <span class="n">parser</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;pad-added&quot;</span><span class="p">,</span> <span class="n">new_pad</span><span class="p">)</span>

  <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filesrc</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="n">conv</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>

  <span class="n">gst</span><span class="o">.</span><span class="n">element_link_many</span><span class="p">(</span><span class="n">filesrc</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
  <span class="n">gst</span><span class="o">.</span><span class="n">element_link_many</span><span class="p">(</span><span class="n">decoder</span><span class="p">,</span> <span class="n">conv</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">eventos</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">gst</span><span class="o">.</span><span class="n">MESSAGE_EOS</span><span class="p">:</span>
      <span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">gst</span><span class="o">.</span><span class="n">MESSAGE_ERROR</span><span class="p">:</span>
      <span class="n">e</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">parse_error</span><span class="p">()</span>
      <span class="k">print</span> <span class="s">&quot;ERROR:&quot;</span><span class="p">,</span> <span class="n">e</span>
      <span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>

  <span class="n">pipeline</span><span class="o">.</span><span class="n">get_bus</span><span class="p">()</span><span class="o">.</span><span class="n">add_watch</span><span class="p">(</span><span class="n">eventos</span><span class="p">)</span>
  <span class="n">pipeline</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">gst</span><span class="o">.</span><span class="n">STATE_PLAYING</span><span class="p">)</span>
  <span class="n">loop</span> <span class="o">=</span> <span class="n">gobject</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Reproduciendo...&quot;</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
  <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span> <span class="c"># Por si se pulsa Ctrl+C</span>
    <span class="k">pass</span>

  <span class="k">print</span> <span class="s">&quot;Parando...&quot;</span>
  <span class="k">print</span> <span class="s">&quot;!Adios!&quot;</span>
  <span class="n">pipeline</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">gst</span><span class="o">.</span><span class="n">STATE_NULL</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
</code></pre></div>
</div>


<h3>Siguiente</h3>
Como ya hemos usado algunos plugins y sabemos como manipularlos, en el próximo artículo hablaremos de una herramienta que nos sirve para navegar entre todos los que tenemos disponibles, obteniendo información acerca de ellos. Hablo de gst-inspect (y después veremos más acerca de las gstreamer-tools). 

      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2006-11-04/instalar-debian-gnu-linux-en-un-compaq-tc-1100" title="Instalar Debian GNU/Linux en un Compaq tc 1100">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/recipe/2006-11-07/cmo-ser-un-gnesis-maintainer" title="Cómo ser un "Gnesis Maintainer"">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Mon Sep 23 23:00:23 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

