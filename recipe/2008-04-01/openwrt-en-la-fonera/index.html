
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>OpenWRT en La Fonera</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#david_villa">
   david.villa
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/41aae9eabb1ef8e1cb8ab5619af82083?s=48" alt="gravatar"/>

</span>

      </li>
      
      <li>
        <!-- AddThis Follow BEGIN -->
<span class="addthis_toolbox addthis_default_style">

<a class="addthis_button_twitter_follow" addthis:userid="david_vi11a"></a>

</span>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Follow END -->

      </li>
      
    

    <li>created: 2008-04-01 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2008-04-01-openwrt-en-la-fonera.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2008-04-01-openwrt-en-la-fonera.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/840">node/840</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#Arco-ref">Arco</a>
    
      <a href="/tags.html#networking-ref">networking</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#Arco-ref">
        <img src="http://crysol.org/files/category_pictures/arco_3D_taxonomy.png" title="Arco" alt="Arco-icon"/>
     </a>
     
  
     
     
     <a class="tag-icon" href="/tags.html#networking-ref">
        <img src="http://crysol.org/files/category_pictures/networking.png" title="networking" alt="networking-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-10-15/virtualbox-compact-vmdk-images">Compacting .vmdk virtual disk with VirtualBox</a></li>
  
    <li><a href="/recipe/2013-10-12/apt-pinning">Debian apt pinning</a></li>
  
    <li><a href="/recipe/2013-10-10/change-primary-monitor">Changing primary monitor</a></li>
  
    <li><a href="/recipe/2013-10-05/virtualbox-import-export-clone">VirtualBox: import/export and cloning machines</a></li>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Converting .vmdk virtual disk to .vdi format from command line</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>OpenWRT en La Fonera </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote class="head">
<p class="head">Esta receta es un resumen <em>quick &amp; dirty</em> de los pasos necesarios para instalar un sistema OpenWRT estándar en La Fonera. Básicamente es una traducción simplificada de las dos recetas que aparecen en las referencias.</p>
</blockquote>
<p><!--break--></p>
<p><strong><span class="caps">IMPORTANTE</span></strong>: Algunos comandos de esta receta pueden bloquear (brick) tu fonera (con erótico resultado). Así que queda bajo tu responsabilidad, luego no me llores :-)</p>
<p><!--break--></p>
<h2>Ingredientes</h2>
<ul>
	<li>netcat</li>
	<li>fping</li>
	<li>Una fonera con <a href="node/700">acceso <span class="caps">SSH</span> habilitado</a></li>
</ul>
<h2>Parchear el kernel</h2>
<p>Accede a la fonera por ssh y ejecuta lo siguiente:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">root@OpenWrt:~#</span> *wget http://fonera.info/camicia/openwrt-ar531x-2.4-vmlinux-CAMICIA.lzma*
<span class="go">Connecting to fonera.info[87.106.220.204]:80</span>
<span class="go">openwrt-ar531x-2.4-v 100% |*****************************|   512 KB    00:00 ETA</span>
<span class="gp">root@OpenWrt:~#</span> *mtd -e vmlinux.bin.l7 write openwrt-ar531x-2.4-vmlinux-CAMICIA.lzma vmlinux.bin.l7*
<span class="go">Unlocking vmlinux.bin.l7 ...</span>
<span class="go">Erasing vmlinux.bin.l7 ...</span>
<span class="go">Writing from openwrt-ar531x-2.4-vmlinux-CAMICIA.lzma to vmlinux.bin.l7 ...  [w]</span>
<span class="gp">root@OpenWrt:~#</span> *sync; reboot*
</code></pre></div></div>
<h2>Actualizando las particiones</h2>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">root@OpenWrt:~#</span> *cd /tmp*
<span class="gp">root@OpenWrt:/tmp#</span> *cp /dev/mtd/5 /tmp/mtd5*
<span class="gp">root@OpenWrt:/tmp#</span> *cp /dev/mtd/6 /tmp/mtd6*
<span class="gp">root@OpenWrt:/tmp#</span> *wget http://fonera.info/camicia/out.hex*
<span class="go">Connecting to fonera.info[62.81.199.144]:80</span>
<span class="go">out.hex              100% |*************************************|  4096       00:00 ETA:-- ETA</span>
<span class="gp">root@OpenWet:/tmp#</span> *md5sum out.hex*
<span class="go">d5a5ee5817da231684c6198801b5cb1f  out.hex</span>
</code></pre></div></div>
<p>Comprueba que el MD5 corresponde para asegurarte de que el fichero ha bajado correctamente.</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">root@OpenWrt:~#</span> *mtd erase <span class="s2">&quot;FIS directory&quot;</span>*
<span class="go">Unlocking FIS directory ...</span>
<span class="go">Erasing FIS directory ...</span>
<span class="gp">root@OpenWrt:~#</span> *cat mtd5 &gt;/dev/mtd/5*
<span class="gp">root@OpenWrt:~#</span> *cat out.hex &gt;/dev/mtd/6*
<span class="gp">root@OpenWrt:~#</span> *sync*
<span class="gp">root@OpenWrt:~#</span> *md5sum out.hex /dev/mtd/6 mtd5 /dev/mtd/5*
<span class="go">d5a5ee5817da231684c6198801b5cb1f  out.hex</span>
<span class="go">d5a5ee5817da231684c6198801b5cb1f  /dev/mtd/6</span>
<span class="go">2d5c82c2a7785e65640199987000cee5  mtd5    </span>
<span class="go">2d5c82c2a7785e65640199987000cee5  /dev/mtd/5</span>
</code></pre></div></div>
<h2>Entrar en el RedBoot</h2>
<p>Todo lo que has hecho antes sirve ni más ni menos que para habilitar el acceso telnet al RedBoot. Lo siguiente es para comprobar que realmente lo has conseguido.</p>
<p>Si todo ha ido bien, cuando reinicies la fonera, el RedBoot abrirá un servidor telnet durante unos segundos en la dirección 192.168.1.254:9000. Si la interfaz de red de tu PC no tiene una IP en el rango 192.168.1.0/24, tienes que añadirle una para poder conectar con el RedBoot. Lo habitual es que tu PC y la fonera estén conectados al mismo switch. Para que no te quedes sin conexión a internet y puedas seguir leyendo esta receta, en lugar de cambiarle la IP, es mejor que le añadas otra, para lo cual ejecuta esto <strong>en el PC</strong>:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span> ip addr add 192.168.1.100/24 dev eth0
</code></pre></div></div>
<p>Obviamente no debe haber ningún otro equipo que tenga esa IP ni tampoco la de la fonera.</p>
<p>Lo siguiente es un scriptillo que debes ejecutar <strong>en el PC</strong>. Este script se encarga de hacer telnet a la fonera en el momento justo.</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">root@OpenWrt:~#</span> &lt;b&gt;while <span class="nb">true</span>; <span class="k">do </span>fping -t 200 192.168.1.254 <span class="o">&amp;&amp;</span> <span class="nb">break</span>; <span class="k">done</span>; sleep 5; <span class="nb">echo</span> -e <span class="s2">&quot;\x3&quot;</span> | nc -w 1 -vvv 192.168.1.254 9000; telnet 192.168.1.254 9000&lt;/b&gt;
<span class="go">192.168.1.254 is unreachable</span>
<span class="go">192.168.1.254 is unreachable</span>
<span class="go">ICMP Host Unreachable from 192.168.1.100 for ICMP Echo sent to 192.168.1.254</span>
<span class="go">192.168.1.254 is unreachable</span>
<span class="go">192.168.1.254 is alive</span>
<span class="go">192.168.1.254: inverse host lookup failed: Unknown host</span>
<span class="go">(UNKNOWN) [192.168.1.254] 9000 (?) open</span>
<span class="go">== Executing boot script in 4.130 seconds - enter ^C to abort</span>
<span class="go">^C</span>
<span class="go">RedBoot&gt; net timeout</span>
<span class="go"> sent 2, rcvd 76</span>
<span class="go">Trying 192.168.1.254...</span>
<span class="go">Connected to 192.168.1.254.</span>
<span class="go">Escape character is &#39;^]&#39;.</span>
<span class="go">RedBoot&gt;</span>
</code></pre></div></div>
<h2>Servidor <span class="caps">TFTP</span></h2>
<p>La única forma que tiene el RedBoot de descargar ficheros de la red es con un cliente <span class="caps">TFTP</span>. Por eso lo más fácil es que pongas <a href="/node/492">un servidor <span class="caps">TFTP</span> en tu PC</a> (receta). Ejecuta lo siguiente <strong>en el PC</strong> para descargar los ficheros necesarios en <code>/srv/tftp</code>, que es el directorio que indica dicha receta:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span> wget http://downloads.openwrt.org/kamikaze/7.09/atheros-2.6/openwrt-atheros-2.6-vmlinux.lzma -O /srv/tftp/vmlinux
<span class="gp">#</span> wget http://downloads.openwrt.org/kamikaze/7.09/atheros-2.6/openwrt-atheros-2.6-root.squashfs -O /srv/tftp/squashfs
</code></pre></div></div>
<h2>Instalación</h2>
<p>Cuando tengas listo el servidor <span class="caps">TFTP</span> y los ficheros en su sitio puedes volver con la fonera. Ejecuta lo siguiente desde el RedBoot. Algunos de estos comandos pueden tardar varios minutos, paciencia y no los cortes que la lías.</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">RedBoot&gt; *ip_address -l 192.168.1.254 -h 192.168.1.100*</span>
<span class="go">IP: 192.168.1.254/255.255.255.0, Gateway: 0.0.0.0</span>
<span class="go">Default server: 192.168.1.100</span>
<span class="go">RedBoot&gt; *load -r -b %{FREEMEMLO} vmlinux*</span>
<span class="go">Using default protocol (TFTP)</span>
<span class="go">Raw file loaded 0x80040c00-0x80100bff, assumed entry at 0x80040c00</span>
<span class="go">RedBoot&gt; *fis init*</span>
<span class="go">About to initialize [format] FLASH image system - continue (y/n)? *y*</span>
<span class="go">*** Initialize FLASH Image System</span>
<span class="go">... Erase from 0xa87e0000-0xa87f0000: .</span>
<span class="go">... Program from 0x80ff0000-0x81000000 at 0xa87e0000: .</span>
<span class="go">RedBoot&gt; *fis create -e 0x80041000 -r 0x80041000 vmlinux.bin.l7*</span>
<span class="go">... Erase from 0xa8030000-0xa80f0000: ............</span>
<span class="go">... Program from 0x80040c00-0x80100c00 at 0xa8030000: ............</span>
<span class="go">... Erase from 0xa87e0000-0xa87f0000: .</span>
<span class="go">... Program from 0x80ff0000-0x81000000 at 0xa87e0000: .</span>
<span class="go">RedBoot&gt; *fis free*</span>
<span class="go">  0xA80F0000 .. 0xA87E0000</span>
</code></pre></div></div>
<p>Estos datos son importantes (sobre todo si a ti te salen diferentes que lo que ves aquí). Resta estas dos números en hexadecimal porque lo necesitas para un comando posterior. Lo puedes hacer con bc:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">$</span> bc
<span class="go">obase=16</span>
<span class="go">ibase=16</span>
<span class="go">A87E0000 - A80F0000</span>
<span class="go">*6F0000*</span>
</code></pre></div></div>
<p>La imagen del sistema de ficheros&#8230;</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">RedBoot&gt; *load -r -b %{FREEMEMLO} squashfs*                   </span>
<span class="go">Using default protocol (TFTP)</span>
<span class="go">Raw file loaded 0x80040c00-0x80160bff, assumed entry at 0x80040c00</span>
</code></pre></div></div>
<p>Pasarlo a flash. Aquí es dónde tienes que utilizar la dirección que calculaste antes:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">RedBoot&gt; *fis create -l 0x6f0000 rootfs*</span>
<span class="go">... Erase from 0xa80f0000-0xa87e0000: ...............................................................................................................</span>
<span class="go">... Program from 0x80040c00-0x80160c00 at 0xa80f0000: ..................</span>
<span class="go">... Erase from 0xa87e0000-0xa87f0000: .</span>
<span class="go">... Program from 0x80ff0000-0x81000000 at 0xa87e0000: .</span>
</code></pre></div></div>
<h2>Afinando</h2>
<p>Al reiniciar La Fonera, tiene un servidor telnet en la IP 192.168.1.1, puedes acceder como <code>root</code>, no tiene clave. Lo más recomendable es que quites el servidor telnet y arranques <code>dropbear</code> (servidor <span class="caps">SSH</span>).</p>
<p>Para permitir <span class="caps">SSH</span> en la interfaz Ethernet escribe (o des-comenta) esto al final de <code>/etc/config/firewall</code>:</p>
<div>
<div class="highlight"><pre><code class="text">accept:proto=tcp dport=22
</code></pre></div></div>
<p>Para que la interfaz Ethernet (eth0) pida una IP por <span class="caps">DHCP</span> cambia el fichero <code>/etc/config/network</code> para que quede así:</p>
<div>
<div class="highlight"><pre><code class="text">config interface loopback
	option ifname	lo
	option proto	static
	option ipaddr	127.0.0.1
	option netmask	255.0.0.0

config interface lan
	option ifname	eth0
	option type 	bridge
	option proto    dhcp
</code></pre></div></div>
<p>Y para activar la interfaz WiFI, elimina la siguiente línea del fichero <code>/etc/config/wireless</code>:</p>
<div>
<div class="highlight"><pre><code class="text">	option disabled 1
</code></pre></div></div>
<p>En ese mismo fichero puedes configurar el <span class="caps">SSID</span> y el tipo de encriptación, por defecto no tiene (&#8220;red insegura&#8221; que dice Windows Vista).</p>
<h2>Comentarios</h2>
<p>Gracias a Paco y a oscarah por sus inestimables aportaciones</p>
<h2>Referencias</h2>
<ul>
	<li><a href="http://blog.coldtobi.de/1_coldtobis_blog/archive/157_la_fonera_a_better_way_to_enable_redboot_via_telnet__ethernet_safely_howto.html">La Fonera: A better way to enable RedBoot via Telnet / Ethernet (safely) [HowTo]</a></li>
	<li><a href="http://blog.coldtobi.de/1_coldtobis_blog/archive/158_install_openwrt_on_the_la_fonera.html">Install OpenWRT on the La Fonera</a></li>
</ul>
<p><!--
http://www.miltonpividori.com.ar/2007/10/16/openwrt-en-mi-router-linksys/
--></p>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2008-04-01/llamadas-voip-desde-nds" title="Llamadas VoIP desde NDS">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/recipe/2008-04-05/instalar-x-wrt-en-la-fonera" title="Instalar X-Wrt en La Fonera">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/web.source" target="_blank">site sources</a>.
	  <br/>
	  Generated at Tue Oct 15 23:53:20 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

