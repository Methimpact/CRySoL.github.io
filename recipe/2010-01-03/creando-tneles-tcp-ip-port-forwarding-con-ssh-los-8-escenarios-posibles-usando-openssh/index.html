
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Creando túneles TCP/IP (port forwarding) con SSH: Los 8 escenarios posibles usando OpenSSH</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#CRySoL">
   CRySoL
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/0a5e5942e2bc4e8f3a80ac323c0f5673?s=48" alt="gravatar"/>

</span>

      </li>
      
    

    <li>created: 2010-01-03 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2010-01-03-creando-tneles-tcp-ip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2010-01-03-creando-tneles-tcp-ip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/1317">node/1317</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#networking-ref">networking</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#networking-ref">
        <img src="http://crysol.org/files/category_pictures/networking.png" title="networking" alt="networking-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Convert .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
    <li><a href="/recipe/2013-07-10/get-shell-user-without-shell">How to get a shell for a non-shell user</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Creando túneles TCP/IP (port forwarding) con SSH: Los 8 escenarios posibles usando OpenSSH </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<p>Esta receta es una copia (gracias a su licencia CC) de un post del blog de <a href="http://">Vicente Navarro</a><a href="http://www.vicente-navarro.com/blog/2009/05/24/creando-tuneles-tcpip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh">www.vicente-navarro.com/blog/2009/05/24/creando-tuneles-tcpip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh</a> (un blog con un contenido estupendo por cierto). La pongo aquí porque me parece un material muy bueno y en previsión de que (<span class="caps">FSM</span> no lo quiera) dicho blog desaparezca repentinamente.</p>
<p><!--break--></p>
<p>La función típica del protocolo de red Secure Shell (<span class="caps">SSH</span>) es acceder en modo terminal a un sistema remoto y ejecutar allí comandos de forma segura gracias a que los datos van cifrados. Pero además, a través de esa conexión de datos segura, es posible crear túneles (reenviar puertos / port forwarding) entre los extremos conectados de forma que las conexiones <span class="caps">TCP</span>/IP se encauzan a través de la conexión <span class="caps">SSH</span> con lo que podemos conseguir saltarnos cualquier firewall o bloqueo de puertos siempre que tengamos la posibilidad de conectar con <span class="caps">SSH</span>.</p>
<p>Como este tema está muy tratado por toda la red:</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Tunneling_protocol#SSH_tunneling">Wikipedia: <span class="caps">SSH</span> Tunneling</a></li>
	<li><a href="http://">O’Reilly: Using <span class="caps">SSH</span> Tunneling</a><a href="http://www.oreillynet.com/pub/a/wireless/2001/02/23/wep.html">www.oreillynet.com/pub/a/wireless/2001/02/23/wep.html</a></li>
	<li><a href="http://">ssh.com: Tunneling Explained</a><a href="http://www.ssh.com/support/documentation/online/ssh/winhelp/32/Tunneling_Explained.html">www.ssh.com/support/documentation/online/ssh/winhelp/32/Tunneling_Explained.html</a></li>
	<li><a href="http://">ssh.com: Port Forwarding</a><a href="http://www.ssh.com/support/documentation/online/ssh/adminguide/32/Port_Forwarding.html">www.ssh.com/support/documentation/online/ssh/adminguide/32/Port_Forwarding.html</a></li>
	<li><a href="http://">SecurityFocus: <span class="caps">SSH</span> Port Forwarding</a><a href="http://www.securityfocus.com/infocus/1816">www.securityfocus.com/infocus/1816</a></li>
	<li><a href="http://magazine.redhat.com/2007/11/06/ssh-port-forwarding/">Red Hat Magazine: <span class="caps">SSH</span> Port Forwarding</a></li>
</ul>
<p>en esta entrada no entraremos en los detalles del reenvío de puertos, sino que pretende ser una chuleta, una referencia rápida (cheat sheet) de cómo reenviar puertos <span class="caps">TCP</span> con OpenSSH en los 8 diferentes escenarios que se pueden dar. Otros clientes de <span class="caps">SSH</span> como PuTTY también permiten el reenvío de puertos, pero la configuración se hará con un interfaz gráfico. Nosotros nos centraremos en OpenSSH.</p>
<p>En los siguientes ejemplos y situaciones supondremos que tenemos una red externa y una red interna y entre ambas redes, la única conexión posible es una conexión <span class="caps">SSH</span> entre el nodo de la red external externo1 y el nodo de la red interna interno1. El nodo externo2 está en la red externa y tiene conectividad total con externo1. El nodo interno2 está en la red interna y tiene conectividad total con interno1.</p>
<center>
<p><img src="/files/ssh_tunnel_sin_tunel.png"/></p>
</center>
<h2>Escenario 1: Usar en externo1 un servicio <span class="caps">TCP</span> ofrecido por interno1</h2>
<p><strong>(Local port forwarding / bind_address=localhost / host=localhost)</strong></p>
<p>El sistema externo1 se puede conectar al sistema interno1 a través de OpenSSH y además quiere conectarse al servidor de <span class="caps">VNC</span> (puerto 5900) del sistema interno1:</p>
<center>
<p><img src="/files/ssh_tunnel_1.png"/></p>
</center>
<p>Lo conseguiremos con este comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -L 7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Ahora en el sistema externo1 podemos comprobar que el puerto 7900 está esperando conexiones:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ netstat -ltn</span>
<span class="go">Active Internet connections (only servers)</span>
<span class="go">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span>
<span class="go">...</span>
<span class="go">tcp        0      0 127.0.0.1:7900            0.0.0.0:*               LISTEN</span>
<span class="go">...</span>
</code></pre></div></div>
<p>Sólo necesitamos ejecutar ahora en externo1:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ vncviewer localhost::7900</span>
</code></pre></div></div>
<p>para conectarnos al servidor <span class="caps">VNC</span> de interno1.</p>
<p>Nota: Esta forma de cambiar el puerto del no está documentada en el <a href="http://">man vncviewer</a><a href="http://www.realvnc.com/products/free/4.1/man/vncviewer.html">www.realvnc.com/products/free/4.1/man/vncviewer.html</a>. Aparece en: <a href="http://">About VNCViewer configuration of the output <span class="caps">TCP</span> port</a><a href="http://www.realvnc.com/pipermail/vnc-list/2006-April/054551.html">www.realvnc.com/pipermail/vnc-list/2006-April/054551.html</a>. También es así como lo hace <a href="http://">el vncviewer de TightVNC</a><a href="http://www.tightvnc.com/vncviewer.1.html">www.tightvnc.com/vncviewer.1.html</a>.</p>
<h2>Escenario 2: Usar en externo2 un servicio <span class="caps">TCP</span> ofrecido por interno1</h2>
<p><strong>(Local port forwarding / bind_address=0.0.0.0 / host=localhost)</strong></p>
<p>Esta vez partimos de una situación similar a la anterior pero ahora queremos que sea externo2 quien se conecte al servidor <span class="caps">VNC</span> de interno1:</p>
<center>
<p><img src="/files/ssh_tunnel_2.png"/></p>
</center>
<p>El comando adecuado sería este:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -L 0.0.0.0:7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Es similar al del primer escenario; pero en aquél, si nos fijamos en la salida del netstat, el puerto 7900 se había asociado a la dirección de localhost, a la 127.0.0.1, por lo que sólo procesos locales podían conectarse a él. Esta vez especificamos que el puerto se asocie a 0.0.0.0, para que el sistema acepte conexiones a cualquier IP local de la máquina:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ netstat -ltn</span>
<span class="go">Active Internet connections (only servers)</span>
<span class="go">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span>
<span class="go">...</span>
<span class="go">tcp        0      0 0.0.0.0:7900            0.0.0.0:*               LISTEN</span>
<span class="go">...</span>
</code></pre></div></div>
<p>De modo que ahora, desde externo2, podemos ejecutar:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo2 $ vncviewer externo1::7900</span>
</code></pre></div></div>
<p>para conectarnos al servidor <span class="caps">VNC</span> de interno1.</p>
<p>En lugar de especificar la IP 0.0.0.0, también podríamos usar la opción -g (Allows remote hosts to connect to local forwarded ports) así:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -g -L 7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<p>con exactamente el mismo resultado que el comando anterior:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1$ ssh -L 0.0.0.0:7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Por otra parte, si hubiéramos querido restringir la conexión a sólo alguna de las IPs locales del sistema, podríamos haber sido más específicos:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -L 192.168.24.80:7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ netstat -ltn</span>
<span class="go">Active Internet connections (only servers)</span>
<span class="go">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span>
<span class="go">...</span>
<span class="go">tcp        0      0 192.168.24.80:7900            0.0.0.0:*               LISTEN</span>
<span class="go">...</span>
</code></pre></div></div>
<h2>Escenario 3: Usar en interno1 un servicio <span class="caps">TCP</span> ofrecido por externo1</h2>
<p><strong>(Remote port forwarding / bind_address=localhost / host=localhost)</strong></p>
<p>En el primer escenario, era el propio sistema con el servidor de <span class="caps">SSH</span> el que ofrecía otro servicio. Ahora el sistema con el cliente de <span class="caps">SSH</span> es el que ofrece el servicio que el sistema con el servidor de <span class="caps">SSH</span> quiere usar:</p>
<center>
<p><img src="/files/ssh_tunnel_3.png"/></p>
</center>
<p>El comando que usaremos es el mismo que en el primer escenario cambiando el parámetro -L por -R:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -R 7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Y ahora donde veremos que tenemos el puerto 7900 escuchando es en interno1:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">interno1 $ netstat -lnt</span>
<span class="go">Active Internet connections (only servers)</span>
<span class="go">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span>
<span class="go">...</span>
<span class="go">tcp        0      0 127.0.0.1:7900          0.0.0.0:*               LISTEN</span>
<span class="go">...</span>
</code></pre></div></div>
<p>De modo que ahora desde interno1 podemos usar el servidor <span class="caps">VNC</span> de externo1 así:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">interno1 $ vncviewer localhost::7900</span>
</code></pre></div></div>
<h2>Escenario 4: Usar en interno2 un servicio <span class="caps">TCP</span> ofrecido por externo1</h2>
<p><strong>(Remote port forwarding / bind_address=0.0.0.0 / host=localhost)</strong></p>
<p>Similar al tercer escenario pero ahora, igual que hacíamos en el segundo escenario, asociaremos el puerto reenviado a la IP 0.0.0.0 para que otros nodos puedan usar el servicio:</p>
<center>
<p><img src="/files/ssh_tunnel_4.png"/></p>
</center>
<p>El comando apropiado es:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -R 0.0.0.0:7900:localhost:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Sin embargo, es importante entender que, por motivos de seguridad, esto no funcionará si en la configuración del servidor de <span class="caps">SSH</span> no modificamos el valor del parámetro GatewayPorts que por defecto está a no:</p>
<div>
<div class="highlight"><pre><code class="text">GatewayPorts

    Specifies whether remote hosts are allowed to connect to ports forwarded for the client. By default, sshd(8) binds remote port
forwardings to the loopback address. This prevents other remote hosts from connecting to forwarded ports. GatewayPorts can be
used to specify that sshd should allow remote port forwardings to bind to non-loopback addresses, thus allowing other hosts to
connect. The argument may be “no” to force remote port forwardings to be available to the local host only, “yes” to force remote
port forwardings to bind to the wildcard address, or “clientspecified” to allow the client to select the address to which the
forwarding is bound. The default is “no”.
</code></pre></div></div>
<p>Si no tenemos la posibilidad de modificar la configuración del servidor, no podremos usar este tipo de reenvío de puertos. Al menos no de forma sencilla, ya que, si no hay otros impedimentos, un usuario puede abrir un puerto (&gt;1024) para escuchar conexiones externas y reenviar dicha petición a localhost:7900. Esto se podría hacer, por ejemplo, con netcat (Debian #310431: sshd_config should warn about GatewayPorts workaround.)</p>
<p>De modo que en el /etc/ssh/sshd_config añadiremos:</p>
<div>
<div class="highlight"><pre><code class="text">GatewayPorts clientspecified
</code></pre></div></div>
<p>tras lo cual tendremos que releer la configuración con “sudo /etc/init.d/ssh reload” (Debian y Ubuntu).</p>
<p>Comprobamos que interno1 está escuchando peticiones de todas las IPs:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">interno1 $ netstat -ltn</span>
<span class="go">Active Internet connections (only servers)</span>
<span class="go">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span>
<span class="go">...</span>
<span class="go">tcp        0      0 0.0.0.0:7900            0.0.0.0:*               LISTEN</span>
<span class="go">...</span>
</code></pre></div></div>
<p>Y ya podremos usar el servicio de <span class="caps">VNC</span> desde interno2:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">interno2 $ vncviewer interno1::7900</span>
</code></pre></div></div>
<h2>Escenario 5: Usar en externo1 un servicio <span class="caps">TCP</span> ofrecido por interno2</h2>
<p><strong>(Local port forwarding / bind_address=localhost / host=interno2)</strong></p>
<center>
<p><img src="/files/ssh_tunnel_5.png"/></p>
</center>
<p>En este escenario usaremos el siguiente comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -L 7900:interno2:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Y accederemos al servicio ejecutando en externo1 el comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ vncviewer localhost::7900</span>
</code></pre></div></div>
<h2>Escenario 6: Usar en interno1 un servicio <span class="caps">TCP</span> ofrecido por externo2</h2>
<p><strong>(Remote port forwarding / bind_address=localhost / host=externo2)</strong></p>
<center>
<p><img src="/files/ssh_tunnel_6.png"/></p>
</center>
<p>En este escenario usaremos el siguiente comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -R 7900:externo2:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Y accederemos al servicio ejecutando en interno1 el comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">interno1 $ vncviewer localhost::7900</span>
</code></pre></div></div>
<h2>Escenario 7: Usar en externo2 un servicio <span class="caps">TCP</span> ofrecido por interno2</h2>
<p><strong>(Local port forwarding / bind_address=0.0.0.0 / host=interno2)</strong></p>
<center>
<p><img src="/files/ssh_tunnel_7.png"/></p>
</center>
<p>En este escenario usaremos el siguiente comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -L 0.0.0.0:7900:interno2:5900 usuario@interno1</span>
</code></pre></div></div>
<p>o alternativamente:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -g -L 7900:interno2:5900 usuario@interno1</span>
</code></pre></div></div>
<p>Y accederemos al servicio ejecutando en externo2 el comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo2 $ vncviewer externo1::7900</span>
</code></pre></div></div>
<h2>Escenario 8: Usar en interno2 un servicio <span class="caps">TCP</span> ofrecido por externo2</h2>
<p><strong>(Remote port forwarding / bind_address=0.0.0.0 / host=externo2)</strong></p>
<center>
<p><img src="/files/ssh_tunnel_8.png"/></p>
</center>
<p>En este escenario usaremos el siguiente comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">externo1 $ ssh -R 0.0.0.0:7900:externo2:5900 usuario@interno1</span>
</code></pre></div></div>
<p>El servidor <span class="caps">SSH</span> tiene que estar configurado con “GatewayPorts clientspecified“, como hemos visto en el escenario 4.</p>
<p>Y accederemos al servicio ejecutando en interno2 el comando:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">interno2 $ vncviewer interno1::7900</span>
</code></pre></div></div>
<p>:wq</p>
<p><strong>[Nota de CRySoL]</strong></p>
<p>Si tienes alguna duda o aportación que hacer sobre el tema, considera hacerla en <a href="http://">el post original</a><a href="http://www.vicente-navarro.com/blog/2009/05/24/creando-tuneles-tcpip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh/">www.vicente-navarro.com/blog/2009/05/24/creando-tuneles-tcpip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh/</a> para así evitar «fragmentación». Por supuesto, si el comentario es para indicar un error por mi parte al copiar la receta, ponlo aquí.</p>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2009-12-30/montar-una-particin-de-un-disco-vdi-de-virtualbox" title="Montar una partición de un disco VDI de VirtualBox">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/script/2010-01-05/escaneando-a-pdf-con-python-y-sane" title="Escaneando a PDF con Python y SANE">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Mon Sep 23 23:00:23 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

