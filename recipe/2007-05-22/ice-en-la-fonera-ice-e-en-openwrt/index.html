
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ice en la fonera: Ice-E en OpenWRT</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#oscarah">
   oscarah
  </a>


        
        <span class="author-photo">

  
    <img src="/assets/files/pictures/picture-111.gif" width="48" alt="picture"/>
  

</span>

      </li>
      
    

    <li>created: 2007-05-22 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2007-05-22-ice-en-la-fonera-ice-e-en-openwrt.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2007-05-22-ice-en-la-fonera-ice-e-en-openwrt.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/698">node/698</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#networking-ref">networking</a>
    
      <a href="/tags.html#embedded-ref">embedded</a>
    
      <a href="/tags.html#Ice-ref">Ice</a>
    
      <a href="/tags.html#Arco-ref">Arco</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#networking-ref">
        <img src="http://crysol.org/files/category_pictures/networking.png" title="networking" alt="networking-icon"/>
     </a>
     
  
     
     
     <a class="tag-icon" href="/tags.html#embedded-ref">
        <img src="http://crysol.org/files/category_pictures/embedded.png" title="embedded" alt="embedded-icon"/>
     </a>
     
  
     
     
     <a class="tag-icon" href="/tags.html#Ice-ref">
        <img src="http://crysol.org/files/category_pictures/zeroc_logo.png" title="Ice" alt="Ice-icon"/>
     </a>
     
  
     
     
     <a class="tag-icon" href="/tags.html#Arco-ref">
        <img src="http://crysol.org/files/category_pictures/arco_3D_taxonomy.png" title="Arco" alt="Arco-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-10-12/apt-pinning">Debian apt pinning</a></li>
  
    <li><a href="/recipe/2013-10-10/change-primary-monitor">Changing primary monitor</a></li>
  
    <li><a href="/recipe/2013-10-05/virtualbox-import-export-clone">VirtualBox: import/export and cloning machines</a></li>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Converting .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Ice en la fonera: Ice-E en OpenWRT </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<p>Esto va sobre <a href="http://zeroc.com/icee/index.html">Ice-E</a>, que es simplemente Ice para dispositivos empotrados. Veamos como configurar el entorno de desarrollo necesario para compilar aplicaciones con Ice-E que funcionen en OpenWRT, concretamente en un <span class="caps">MIPS</span>: el de la fonera.</p>
<p><!--break--></p>
<h2>Ingredientes</h2>
<ol>
<li>Una fonera (o cualquier hardware donde se pueda instalar OpenWRT y derivados)</li>
<li>Las fuentes de OpenWRT (kamikaze por estas fechas)</li>
<li>Las fuentes de Ice-E (que ahora va por la versión 1.2.0)</li>
<li>Las dependencias de los anteriores</li>
<li>Un rato libre (de rigor :-p )</li>
</ol>
<h2>Preparando el terreno</h2>
<p>Seguro que ya has encontrado la utilidad de tener Ice en un cacharrito pequeño que tiene un atheros&#8230; así que yo no te voy a dar muchas pistas :-p. Sea cual sea ese cacharrito, debe tener OpenWRT o derivados (como lo que trae la fonera).</p>
<p>Lo primero que tienes que hacer es conseguir el toolchain para hacer una compilacion cruzada (cross compilation que dice algunos). En este caso, descárgate las fuentes del OpenWRT, que están disponibles en <a href="http://downloads.openwrt.org/snapshots/">downloads.openwrt.org</a>. Elige el micro que tengas, en el caso que nos ocupa es atheros:</p>
<pre class="console">
lab@bart:fonera$ pwd
/home/lab/fonera
lab@bart:fonera$ wget -c http://downloads.openwrt.org/snapshots/atheros-2.6/OpenWrt-SDK-atheros-2.6-for-Linux-i686.tar.bz2
</pre>
<p>Paciencia, son unos 42 MiB.</p>
<p>También necesitas las fuentes de ZeroC Ice-E, que están en <a href="http://www.zeroc.com/icee/download.html">la web de ZeroC Ice</a>:</p>
<pre class="console">
lab@bart:fonera$ wget -c http://www.zeroc.com/download/IceE/1.2/IceE-1.2.0.tar.gz
</pre>
<p>Cuano escribí esto, hacía una semana escasa que salió la versión 1.2.0 y será esa la que usemos. Existen dos variantes, una para C++ y otra para Java. Usamos la de C++. Además necesitamos las herramientas de traducción (ya sabes, slice2<i><span class="caps">XXX</span></i>), que también tienes que bajarte (a menos que estén empaquetadas ya&#8230; que seguro que Paco ya lo ha hecho :-)):</p>
<pre class="console">
lab@bart:fonera$ wget -c http://www.zeroc.com/download/IceE/1.2/IceE-trans-1.2.0.tar.gz
</pre>
<p>Bien, una vez aquí, podemos desempaquetarlo todo:</p>
<pre class="console">
lab@bart:fonera$ ls
IceE-1.2.0.tar.gz  IceE-trans-1.2.0.tar.gz  OpenWrt-SDK-atheros-2.6-for-Linux-i686.tar.bz2
lab@bart:fonera$ tar zxf IceE-1.2.0.tar.gz 
lab@bart:fonera$ tar zxf IceE-trans-1.2.0.tar.gz 
lab@bart:fonera$ tar jxf OpenWrt-SDK-atheros-2.6-for-Linux-i686.tar.bz2 
lab@bart:fonera$ ls
IceE-1.2.0         IceE-trans-1.2.0         OpenWrt-SDK-atheros-2.6-for-Linux-i686
IceE-1.2.0.tar.gz  IceE-trans-1.2.0.tar.gz  OpenWrt-SDK-atheros-2.6-for-Linux-i686.tar.bz2
lab@bart:fonera$ 
</pre>
<h2>Compilando</h2>
<p>Ahora toca configurar y compilar. Primero necesitas la toolchain del OpenWRT, que está disponible en el buildroot que te acabas de bajar. Ya te viene precompilado, pero tienes que comprobar que es la misma versión que la del kernel del chisme final (aunque esto no suele ser crítico). Si no es así, tienes que compilar e instalar el nuevo kernel. En la <a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Fon/Fonera">página sobre la fonera</a> de OpenWRT encontrarás información sobre cómo hacer esto. También te puedes bajar el kernel compilado junto con el <span class="caps">SDK</span>, así te ahorras un paso.</p>
<p>De cualquier modo, en la carpeta <i>staging_dir_mips</i> tienes todas las herramientas necesarias para compilar Ice-E (y casi cualquier cosa en <span class="caps">ANSI</span> C/C++). Así que añade al principio del <span class="caps">PATH</span> la carpeta bin. Además, siguiendo las directivas de <span class="caps">README</span> correspondiente, tienes que establecer el compilador que usarás: mips-linux-c++</p>
<pre class="console">
lab@bart:staging_dir_mips$ pwd
/home/lab/fonera/OpenWrt-SDK-atheros-2.6-for-Linux-i686/staging_dir_mips
lab@bart:staging_dir_mips$ export PATH=`pwd`/bin:$PATH
lab@bart:staging_dir_mips$ export CXX=mips-linux-c++
</pre>
<p>Ya que estamos aquí, un breve apunte. Si tu dispositivo tiene poco espacio disponible, como es el caso de la fonera, te interesa que todo esto ocupe lo menos posible. Para ello, puedes hacer un par de cosas. La primera es enlazar tus programas de forma estática, por lo que necesitas hacer las librerías de IceE aptas para ello. Con esto consigues que el binario final sea autosuficiente, sin más cosas de las que necesita. Esto tiene ventajas y desventajas: por un lado aumenta el rendimiento y optimiza el espacio, pero si tienes muchos binarios que tiran de la misma librería, quizá no te convenga. Si decides hacer IceE para enlazado estático, necesitas a AR:</p>
<pre class="console">
lab@bart:staging_dir_mips$ export AR=mips-linux-ar
</pre>
<p>En esta carpeta has terminado. Es hora de compilar IceE-trans. Evidentemente, slice2cppe lo vas a usar en la máquina de desarrollo, por lo que debes compilarlo con las herramientas habituales. Abre un nuevo terminal y vete a donde descomprimiste IceE-trans. Puedes ejecutar make sin miedo&#8230; e irte a tomar algo :-p</p>
<p>¿Ya? Bien, pues ahora instálalo con el consabido <i>make install</i> como root. Te creará una carpeta en /opt/ llamada IceE-1.2.0 con los binarios necesarios. Esto también lo necesitarás en el <span class="caps">PATH</span>, así que en el otro terminal (en el que empezaste), añádelo:</p>
<pre class="console">
lab@bart:IceE-trans-1.2.0$ ls /opt/IceE-1.2.0/bin/
icecpp  slice2cppe  slice2javae
lab@bart:IceE-trans-1.2.0$ export PATH=/opt/IceE-1.2.0/bin/:$PATH
lab@bart:IceE-trans-1.2.0$ 
</pre>
<p>¿Listo para compilar IceE? Vale, pues vete a la carpeta donde se extrajo. Antes de compilar, tienes que editar las reglas del make, para reducir el tamaño de las librerías y hacerlas estáticas (si quieres). Si no cambias nada, sólo las librerías te ocuparán unos 20 MiB, porque se añaden los símbolos para depuración. Yo en mi caso, las hice estáticas y además com optimización de tamaño (sin símbolos) y me ocupan sobre los 3 MiB.</p>
<p>Edita el fichero Make.rules que está dentro de </i>config</i>. Está muy bien documentado, por lo que no creo que tengas muchos problemas. Descomenta las líneas siguientes:</p>
<pre>
OPTIMIZE_SIZE        = yes
STATICLIBS           = yes
</pre>
<p>Ahora, ya puedes compilar:</p>
<pre class="console">
lab@bart:IceE-1.2.0$ pwd
/home/lab/fonera/IceE-1.2.0
lab@bart:IceE-1.2.0$ make
...
</pre>
<p>Tardará un rato en terminar. Cuando lo haya hecho, habrá compilado las librerías estáticas y unos tests. Si observas, las librerías ocupan sobre 6.7 MiB, pero cuando enlaces sólo se llevará tu programa lo que necesite. Si las haces dinámicas, el tamaño total será alrededor de 3.2 MiB, pero las necesitarás enteras. Si haces un servidor sencillo, estático te ocupará alrededor de 1.7 MiB, dinámico será de 300 KiB + 3.2 MiB de la lib. La elección es tuya. :-p</p>
<p>Después de este rollete, habrá terminado ya la compilación, ¿no? Pues entonces tira esa cafetera&#8230; es broooma :-)</p>
<h2>Probando</h2>
<p>Buno, supongamos que es mañana por la tarde y has terminado de compilar (sin lamentar daños). ¡Pues ya lo tienes! En los demos, hay un <i>hola mundo</i> sencillo que puedes probar. Métete en la fonera y envíate el fichero: IceE-1.2.0/demo/IceE/minimal/server</p>
<p>(<span class="caps">NOTA</span>: cambia los nombres&#8230;)</p>
<pre class="console">lab@bart:minimal$ nc -l -p 5555 -q 0 &lt; server &amp;
lab@bart:minimal$ ssh root@fonera
...
root@fonera:~# nc bart 5555 &gt; server
root@fonera:~# </pre>
<p>Si lo ejecutas, verás que te dice que faltan cosas. Me temo que no toda la compilación ha sido estática. Bueno, no pasa nada. Lo más probable es que te falte la librería de hilos y la de std c++. Sean las que sean, si te lo ha enlazado, deben estar en el buildroot, en <i>OpenWrt-<span class="caps">SDK</span>-atheros-2.6-for-Linux-i686/staging_dir_mips/lib</i>. Cópialas en la fonera, en <i>/lib</i> y haz los enlaces correspondientes&#8230;</p>
<p>¿Ya? Bueno, pues cuando ejecutes el server y no te falten librerías, lo que te faltará es un fichero de configuración: el <i>config</i>, cópialo en la fonera o hazte uno y lanza de nuevo. Si se queda esperando, es posible que lo hayas conseguido :-p ¡Enhorabuena! Ahora puedes probarlo con el cliente (<span class="caps">TIP</span>: el proxy esta en el config :-p)</p>
<p>Y ya está. Ahora sólo te queda buscarle usos, que te aseguro que tiene muchos&#8230;</p>
<h2>Referencias</h2>
<ol>
<li><a href="http://sistemasorp.blogspot.com/2006/11/compilando-programas-para-la-fonera.html">Compilando programas para la fonera</a></li>
<li><a href="http://downloads.openwrt.org/docs/buildroot-documentation.html#using_toolchain">OpenWRT buildroot: using the uClib toolchain</a></li>
<li><a href="http://www.zeroc.com/">The home of Ice</a></li>
</ol>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2007-05-21/sincroniza-tus-ficheros-con-unison" title="Sincroniza tus ficheros con Unison">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/recipe/2007-05-23/apt-build-cuando-debian-huele-a-gentoo" title="apt-build: cuando Debian huele a Gentoo">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Sat Oct 12 17:17:07 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

