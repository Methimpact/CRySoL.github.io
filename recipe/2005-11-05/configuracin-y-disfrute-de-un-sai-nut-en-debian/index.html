
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Configuración y disfrute de un SAI: NUT en Debian</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#david_villa">
   david.villa
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/41aae9eabb1ef8e1cb8ab5619af82083?s=48" alt="gravatar"/>

</span>

      </li>
      
      <li>
        <!-- AddThis Follow BEGIN -->
<span class="addthis_toolbox addthis_default_style">

<a class="addthis_button_twitter_follow" addthis:userid="david_vi11a"></a>

</span>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Follow END -->

      </li>
      
    

    <li>created: 2005-11-05 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2005-11-05-configuracin-y-disfrute-de-un-sai-nut-en-debian.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2005-11-05-configuracin-y-disfrute-de-un-sai-nut-en-debian.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/82">node/82</a></li>
  

  
  </ul>

  
     
     
  

  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-10-10/change-primary-monitor">Changing primary monitor</a></li>
  
    <li><a href="/recipe/2013-10-05/virtualbox-import-export-clone">VirtualBox: import/export and cloning machines</a></li>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Converting .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Configuración y disfrute de un SAI: NUT en Debian </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote>
<p>Esta receta explica cómo instalar y configurar la herramienta <acronym title="Network UPS Tools"><span class="caps">NUT</span></acronym> para aprovechar al máximo las posibilidades de un <acronym title="Sistema de Alimentación Ininterrumpida"><span class="caps">SAI</span></acronym> en un sistema Debian <span class="caps">GNU</span>/Linux. Concretamente, los pasos son para un <span class="caps">MGE</span> Pulsar Extreme 1500C</p>
</blockquote>
<h2>Introducción</h2>
<p>Instalar un software de control para un <span class="caps">SAI</span> sólo tiene sentido si podemos hablar con él para obtener datos de su estado y funcionamiento. Si el <span class="caps">SAI</span> no tiene ningún tipo de conexión de datos (tal como serie o <span class="caps">USB</span>) esta receta no te sirve. En cualquier caso, un <span class="caps">SAI</span> que no dice nada sobre su estado es de muy poca utilidad. Si estás pensado en comprar un <span class="caps">SAI</span>, elige uno con el que puedas hablar. En la <a href="http://www.networkupstools.org/">página de nut</a> hay una <a href="http://www.networkupstools.org/compat/">lista</a> de las marcas y modelos compatibles.</p>
<h2>Instalación</h2>
<p>Si tienes una distro compatible Debian, instalar el paquete <acronym title="Network UPS Tools"><b>nut</b></acronym> es así de fácil:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="go"> # apt-get install nut</span>
</code></pre></div></div>
<h2>Descripción</h2>
<p>Este software tiene una arquitectura cliente/servidor. Esta configuración permite que varios equipos alimentados por un único <span class="caps">SAI</span> (y que ejecutan un cliente) puedan <em>hablar</em>, a través de la red, con el equipo que tiene la conexión de datos del <span class="caps">SAI</span> (y que ejecuta el servidor). De este modo, ante un corte de corriente, todos los equipos quedan informados y pueden actuar en consecuencia.</p>
<p>Por este motivo, aunque el <span class="caps">SAI</span> dé servicio a una sola máquina, será necesario instalar un servidor y un cliente.</p>
<h2>Funcionalidad</h2>
<p>Lógicamente, la función de un <span class="caps">SAI</span> o <acronym title="Uninterruptible Power Supply"><span class="caps">UPS</span></acronym> (mantener la alimentación durante cortes de luz) es insuficiente para un servidor, ya que es muy probable que no haya nadie para apagar el equipo durante el tiempo de duración de las baterías. El software <em>nut</em> ofrece servicios mucho más interesantes:</p>
<ul>
  <li>Fijar un umbral de bateria, por debajo del cual el equipo conectado al <span class="caps">SAI</span> se apaga automáticamente.  </li>
  <li>Desconexión del <span class="caps">SAI</span>. De este modo las baterías no se agotan inútilmente, pues ya no hay nada que alimentar.  </li>
  <li>Fijar umbrales de carga máxima.  </li>
  <li>Monitorización y configuración remota (por medio de <span class="caps">CGI</span>).  </li>
</ul>
<p>Con esa configuración, ante un corte de luz, ocurre lo siguiente:</p>
<ul>
  <li>El <span class="caps">SAI</span> pasa a modo batería.  </li>
  <li>Al bajar el nivel de carga de la batería al umbral fijado, el driver que corre en el servidor lo detecta e informa a todos los clientes.  </li>
  <li>Los clientes inician el proceso de apagado de cada equipo.  </li>
  <li>Justo antes de apagarse, el servidor envía al <span class="caps">SAI</span> el comando de desconexión.  </li>
  <li>El <span class="caps">SAI</span> recibe el comando, espera un tiempo prefijado y después se apaga.  </li>
</ul>
<p>Al volver la corriente:</p>
<ul>
  <li>El <span class="caps">SAI</span> enciende automáticamente.  </li>
  <li>Cuando la fuente de alimentación del PC detecta voltaje (procedente del <span class="caps">SAI</span>) arranca el equipo. Para esto es necesario configurar el <span class="caps">BIOS</span> Setup de cada ordenador.  </li>
</ul>
<p>No todos los SAIs pueden hacer todo lo que se índica. Tendrás más o menos posibilidades dependiendo de la gama y precio del <span class="caps">SAI</span>.</p>
<h2>Configuración</h2>

<h3>Configuración común</h3>
<p>Lo primero, y antes de que se nos olvide, será cambiar los permisos del puerto serie (<tt>/dev/ttyS0</tt> o <tt>/dev/ttyS1</tt>), pues nos debe dejar leer y escribir en él como <tt>root</tt>. En Debian, los puertos serie suelen pertenecer al grupo <tt>dialout</tt>, así que la manera más fácil de conseguir permiso es:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span> addgrp nut dialout 
</code></pre></div></div>

<p>En <tt>/etc/nut/ups.conf</tt> habrá que realizar algunos cambios (tanto en cliente como en servidor). Aquí es donde se añade el driver (cada familia de SAIs tiene su propio driver):</p>
<div>
<div class="highlight"><pre><code class="text">[id]
   driver = (driver)
   port = (port)
   (options)
</code></pre></div></div>
<p>Por ejemplo, para un <span class="caps">SAI</span> &#8220;<span class="caps">MGE</span> Pulsar Extreme&#8221; será:</p></p>
<div>
<div class="highlight"><pre><code class="text">[mge]
   driver = mge-utalk
   port = /dev/ttyS0
   LowBatt = 90
</code></pre></div></div>
<h3>Configuración del servidor</h3>

<p>Edita el fichero <tt>/etc/default/nut</tt> modificando la línea <tt>&#8220;START_UPSD=no&#8221;</tt> por <tt>&#8220;START_UPSD=yes&#8221;</tt></p>
<p>En el fichero <tt>/etc/nut/upsd.conf</tt> tienes que crear la lista de control de acceso (<span class="caps">ACL</span>). Para ello incluye (si no existe ya):</p></p>
<div>
<div class="highlight"><pre><code class="text">ACL all 0.0.0.0/0
ACL localhost 127.0.0.1/32                  # host actual
ACL [NombreMáquina] 192.168.0.0/24    # toda la red

ACCESS grant login localhost [password]
ACCESS grant monitor localhost [password]

ACCESS grant login [NombreMaquina] [password]
ACCESS grant monitor [NombreMáquina] [password]
ACCESS deny all all
</code></pre></div></div>
<p>Por último, edita el fichero <tt>/etc/nut/upsd.users</tt>  para dar acceso a los usuarios. Para ello, añade las  líneas:</p></p>
<div>
<div class="highlight"><pre><code class="text">[monuser]
        password = [password]
        allowfrom = localhost 192.168.0.0/24     # tu red
</code></pre></div></div>
<h3>Configuración del cliente</h3>
<p>Edita el fichero <tt>/etc/default/nut</tt> modificando la línea <tt>&#8220;START_UPSMON=no&#8221;</tt> por <tt>&#8220;START_UPSMON=yes&#8221;</tt></p>
<p>Lo siguiente será <tt>/etc/nut/upsmon.conf</tt>. Éste es el fichero de configuración del cliente.  La línea obligatoria a añadir es la del monitor:</p>
<div>
<div class="highlight"><pre><code class="text">MONITOR [id]@[ip] 1 [password] slave|master
</code></pre></div></div>

<p>Lo normal para el equipo que tiene la conexión de datos al <span class="caps">SAI</span> es que funcione en modo &#8220;master&#8221;. Eso significa que debe esperar a que los &#8220;slaves&#8221; apaguen antes de hacerlo él. Así que quedará algo como esto:</p>
<div>
<div class="highlight"><pre><code class="text">MONITOR mge@192.168.0.1 1 [password] master
</code></pre></div></div>

<p>Ahora debes reniciar el servicio de la forma habitual:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span> /etc/init.d/nut restart
</code></pre></div></div>
<h2>Consejos</h2>
<p>Lo mejor es que la primera vez se arranque todo a mano, pues el <em>script</em> descrito en la sección anterior redirige todos los errores a <tt>/dev/null</tt>. Para ello se hará:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span> upsdrvctl start
<span class="go">Network UPS Tools - UPS driver controller 1.2.1</span>
<span class="go">Network UPS Tools - MGE UPS SYSTEMS/U-Talk driver 0.51.0 (1.2.1)</span>
<span class="gp">#</span>
<span class="gp">#</span> upsd
<span class="go">Network UPS Tools upsd 1.2.1</span>
<span class="gp">#</span>
<span class="gp">#</span> upsmon
<span class="go">UPS: mge@192.168.0.1 (slave) (power value 1)</span>
<span class="go">Using power down flag file /etc/killpower</span>
<span class="gp">#</span>
</code></pre></div></div>
<p>Puedes ver que la monitorización funciona adecuadamente con el comando <tt>upsc</tt>:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span> upsc mge
<span class="go">UPS: localhost</span>
<span class="go">MFR: MGE UPS SYSTEMS</span>
<span class="go">STATUS: OL CHRG</span>
<span class="go">UPSIDENT: EXtreme 1500C 15</span>
<span class="go">MODEL: EXtreme 1500C</span>
<span class="go">FIRMREV: 15</span>
<span class="go">UTILITY: 230.0</span>
<span class="go">BATTPCT: 100.0</span>
<span class="go">BATT_RUNTIME: 01890</span>
<span class="go">ACFREQ: 50.00</span>
<span class="go">LOADPCT: 026.0</span>
<span class="go">WAKEDELAY: 001</span>
<span class="go">GRACEDELAY: 120</span>
<span class="go">SLFTSTINT: 10080</span>
<span class="go">OUTVOLT: 230.5</span>
<span class="go">BATTVOLT: 054.6</span>
<span class="go">LOBATTPCT: 90</span>
<span class="go">NOMBATVLT: 048.0</span>
<span class="go">CURRENT: 001.2</span>
</code></pre></div></div>
<p>Y eso es todo.</p>
<h2>Referencias</h2>
<ul>
	<li><a href="http://">Network <span class="caps">UPS</span> Tools</a><a href="http://www.networkupstools.org/">www.networkupstools.org/</a></li>
	<li><a href="http://opensource.mgeups.com/howto.htm"><span class="caps">MGE</span> and <span class="caps">NUT</span> How-To</a></li>
	<li><a href="http://">Gestionando un <span class="caps">SAI</span> desde OpenBSD con <span class="caps">NUT</span></a><a href="http://www.usebox.net/jjm/ups-obsd/">www.usebox.net/jjm/ups-obsd/</a></li>
	<li><a href="http://">Monitorizar un <span class="caps">SAI</span> con Debian</a><a href="http://www.servitux.org/view.php/page/sai">www.servitux.org/view.php/page/sai</a></li>
</ul>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/tale/2005-11-04/problemillas-con-xorg" title="Problemillas con Xorg">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/cooking/2005-11-06/guacamole-top" title="Guacamole "Top"">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Thu Oct 10 13:59:24 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

