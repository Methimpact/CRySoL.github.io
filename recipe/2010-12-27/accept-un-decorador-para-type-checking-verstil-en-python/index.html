
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>accept: un decorador para type-checking versátil en Python</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#david_villa">
   david.villa
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/41aae9eabb1ef8e1cb8ab5619af82083?s=48" alt="gravatar"/>

</span>

      </li>
      
      <li>
        <!-- AddThis Follow BEGIN -->
<span class="addthis_toolbox addthis_default_style">

<a class="addthis_button_twitter_follow" addthis:userid="david_vi11a"></a>

</span>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Follow END -->

      </li>
      
    

    <li>created: 2010-12-27 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2010-12-27-accept-un-decorador-para-type-checking-verstil-en-python.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2010-12-27-accept-un-decorador-para-type-checking-verstil-en-python.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/1443">node/1443</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#Python-ref">Python</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#Python-ref">
        <img src="http://crysol.org/files/category_pictures/python.png" title="Python" alt="Python-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
    <li><a href="/recipe/2013-07-10/get-shell-user-without-shell">How to get a shell for a non-shell user</a></li>
  
    <li><a href="/recipe/2013-07-09/puppet-install-latest-package">Ensuring last version of a package with puppet</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>accept: un decorador para type-checking versátil en Python </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<p>Una de las cosas que más chocan al empezar a utilizar un lenguaje dinámico (Python, Ruby, Lua, etc.) es que las variables no se declaran o definen con un tipo concreto. Eso normalmente no es un problema y de hecho resulta bastante cómodo. Pero cuando un programa adquiere cierta envergadura empiezan a surgir problemas.</p>
<p>Poder forzar la interfaz de un método, sobre todo de un constructor es más que conveniente. Permite detectar muchos usos inadecuados cuando el usuario de una clase y su programador son personas distintas (o uno mismo si ha pasado demasiado tiempo). Esto es básico para cosas como el <a href="http://en.wikipedia.org/wiki/Design_by_contract">Diseño por contrato</a> y otras metodologías en las que es imprescindible tener comprobación estricta de tipos.</p>
<p><!--break--></p>
<h2>Tipado estático</h2>
<p>El propio Guido sorprendió en su momento a propios y extraños con su propuesta <a href="http://">Adding Optional Static Typing to Python</a><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=85551">www.artima.com/weblogs/viewpost.jsp?thread=85551</a> hace ya unos años. A pesar de todo (al menos por lo que yo sé) nada de esto ha sido incluido aún en las últimas versiones de Python. Sí se han incluido en Python 3 las <a href="http://">Function Annotations</a><a href="http://www.python.org/dev/peps/pep-3107/">www.python.org/dev/peps/pep-3107/</a> que ofrecen soporte para implementar tipado estático, aunque la distribución estándar no lo hace.</p>
<p>La cuestión es que debido a esta <em>carencia</em> es muy habitual encontrar en muchas librerías de uso extendido cosas parecidas a esto:</p>
<div>
<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div></div>
<p>Y cuando este tipo de comprobaciones prolifera hace un poco más engorroso leer el código, y eso siempre es malo.</p>
<h2>Decoradores</h2>
<p>La forma más habitual de afrontar más o menos limpiamente este problema es utilizar <a href="http://">decoradores</a><a href="http://www.python.org/dev/peps/pep-0318/">www.python.org/dev/peps/pep-0318/</a> de función. Bueno, lo que en Python se llaman «decoradores» aunque siendo mínimamente puristas no lo son porque no corresponden con la idea del <a href="http://en.wikipedia.org/wiki/Decorator_pattern">patrón de diseño decorator</a>.</p>
<p>Un decorador de función (o método) en Python es otra función que recibe la función original y retorna otra función (la función decorada). Esta función decorada debería invocar en algún momento a la función original, y opcionalmente hacer algo más (ese algo más es la decoración). La ventaja de esto es obvia. Si se hace bien, se puede utilizar la función original o la decorada de forma indistinta. Se supone que la decoración añade efectos laterales. En muchos sentidos, algo parecido a la <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">Programación Orienta a Aspectos</a></p>
<p>Bueno, esto es más de lo que tenía pensado contar sobre decoradores. Algún día escribiré una receta ex profeso, por ahora, mira el <a href="http://"><span class="caps">PEP</span>-318</a><a href="http://www.python.org/dev/peps/pep-0318/">www.python.org/dev/peps/pep-0318/</a>.</p>
<h2>Implementando type-checking con un decorador</h2>
<p>Como decía, no soy el primero al que se le ocurre forzar tipos con un decorador (aplico la máxima de <a href="http://crysol.org/node/1377">copiar-antes-que-innovar</a> que tan buen resultado suele dar). El decorador más completo que he encontrado es el de la <a href="http://wiki.python.org/moin/PythonDecoratorLibrary#TypeEnforcement.28accepts.2BAC8-returns.29">PythonDecoratorLibrary</a>. Éste tiene una «feature» muy interesante: Puedes decidir qué ocurrirá si falla la comprobación de tipo: nada, un mensaje por stderr o una excepción. Aquí va un ejemplo (sacado de la página):</p>
<div>
<div class="highlight"><pre><code class="python"><span class="n">TYPE_CHECK</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">TYPE_CHECK</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="k">return</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>
<p>Sin embargo no me convence, yo le pido más cosas:</p>
<ul>
	<li>Poder indicar el tipo solamente de algunos parámetros. El de arriba te obliga a poner los tipos de todos los parámetros de método o función.</li>
	<li>Poder indicar los tipos de forma posicional o bien mediante la keyword (el nombre del parámetro formal).</li>
	<li>Poder poner varios tipos posibles para el mismo parámetro. Por ejemplo, para decir que se debe poner una cadena, pero también vale None.</li>
	<li>Poder indicar el tipo de una lista de parámetros «varargs», como en <code>*values</code>.</li>
	<li>Poder decorar el resultado de este decorador con otros, si fuera necesario. La mayoría de los decoradores no respetan al 100% el «aspecto» de la función original (no son capaces de hacerse pasar perfectamente por la original) y eso complica mucho aplicar decoradores de forma anidada. Para lograr esto he utilizado una implementación de wrapper genérico que se puede encontrar en <a href="http://denis.ryzhkov.org/soft/python_lib/method_decorator.py">http://denis.ryzhkov.org/soft/python_lib/method_decorator.py</a></li>
	<li>La consecuencia de violar un tipo debería poderse elegir globalmente (al menos a nivel de módulo) en lugar de en cada llamada. Me parece mucho más cómodo para el propósito que nos ocupa.</li>
	<li>Esas consecuencias deberían ser: no hacer nada, un <a href="http://docs.python.org/library/warnings.html">warning</a> o un excepción.</li>
</ul>
<h2>El decorador <code>accept</code></h2>
<p>Con todo lo anterior he escrito una versión mejorada del de PythonDecoratorLibrary, aunque lo cierto es que el código no se parece en absoluto, para empezar es un <a href="http://en.wikipedia.org/wiki/Function_object">functor</a> en lugar de una función. Mi <code>accept</code> soporta todo lo que he puesto ahí arriba. Lo podéis encontrar en el módulo <code>pyarco</code> que se instala junto con el paquete debian de <code>atheist</code>. También lo puedes ver en el repositorio subversion: <a href="https://arco.esi.uclm.es/svn/public/prj/atheist/pyarco/Type.py">https://arco.esi.uclm.es/svn/public/prj/atheist/pyarco/Type.py</a></p>
<p>A continuación voy a ilustrar su uso mediante algunos ejemplos, que creo que es la forma más fácil de entenderlo:</p>
<ul>
	<li>Una función en la que se indica el tipo de todos los parámetros (por posición):</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">pyarco.Type</span> <span class="kn">import</span> <span class="n">accept</span>

<span class="nd">@accept</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
     <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="s">&quot;bye&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;hi&quot;</span><span class="p">)</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">Argument</span> <span class="s">&#39;i1&#39;</span> <span class="n">should</span> <span class="n">be</span> <span class="s">&#39;int&#39;</span> <span class="p">(</span><span class="s">&#39;str&#39;</span> <span class="n">given</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Todos los parámetros pero con keywords:</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">(</span><span class="n">i1</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">i2</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
     <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div></div>
<ul>
	<li>Indicando solo algunos tipos (con keywords):</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">(</span><span class="n">i1</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
     <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bye&quot;</span><span class="p">,</span> <span class="s">&quot;hi&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bye&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="s">&quot;hi&quot;</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Con una función que tiene valores por defecto:</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">(</span><span class="n">i1</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">i2</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">Argument</span> <span class="s">&#39;s1&#39;</span> <span class="n">should</span> <span class="n">be</span> <span class="s">&#39;str&#39;</span> <span class="p">(</span><span class="s">&#39;int&#39;</span> <span class="n">given</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Con una función que acepta una secuencia (varargs):</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">):</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Una función que acepta una función y una tupla (opcional):</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">():</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Un método:</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="nd">@accept</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a1</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Un constructor:</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="nd">@accept</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Un constructor que llama al constructor de la superclase. Es este caso es obligatorio usar el formato de keywords. No acepta parámetros posicionales:</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="nd">@accept</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">A</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>

<span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Un parámetro que permite varios tipos (posicional):</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="p">(</span><span class="s">&#39;hi&#39;</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Varios tipos (con keyword):</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="nd">@accept</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="p">(</span><span class="s">&#39;hi&#39;</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Sin consecuencia al violar el tipo. Como has visto, por defecto se eleva la excepción TypeError.</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="n">accept</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="bp">None</span>

<span class="nd">@accept</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">):</span> <span class="k">pass</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">)</span>
</code></pre></div></div>
<ul>
	<li>Emitiendo un warning</li>
</ul>
<div>
<div class="highlight"><pre><code class="python"><span class="n">accept</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="s">&#39;warn&#39;</span>

<span class="nd">@accept</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">):</span> <span class="k">pass</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">)</span>
<span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">Argument</span> <span class="s">&#39;value&#39;</span> <span class="n">should</span> <span class="n">be</span> <span class="s">&#39;int&#39;</span> <span class="p">(</span><span class="s">&#39;str&#39;</span> <span class="n">given</span><span class="p">)</span>
</code></pre></div></div>
<h2>Referencias</h2>
<ul>
	<li><a href="http://">Adding Optional Static Typing to Python</a><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=85551">www.artima.com/weblogs/viewpost.jsp?thread=85551</a></li>
	<li><a href="http://">Function Annotations</a><a href="http://www.python.org/dev/peps/pep-3107">www.python.org/dev/peps/pep-3107</a></li>
	<li><a href="http://">Decoradores de funciones y métodos en Python</a><a href="http://www.python.org/dev/peps/pep-0318/">www.python.org/dev/peps/pep-0318/</a></li>
	<li><a href="http://wiki.python.org/moin/PythonDecoratorLibrary">PythonDecoratorLibrary</a></li>
	<li><a href="http://denis.ryzhkov.org/soft/python_lib/method_decorator.py">Decorador de métodos transparente</a></li>
</ul>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2010-12-26/formatos-simples-xml-yaml-json-properties-e-inis" title="Formatos simples: XML, Yaml, Json, Properties e INI's">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/opinion/2010-12-28/tomates-piratas" title="Tomates Piratas">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Fri Sep 20 16:34:47 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

