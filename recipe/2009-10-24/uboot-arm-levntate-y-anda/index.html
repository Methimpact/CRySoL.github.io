
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>uBoot: "ARM, Lev√°ntate y anda"</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#javieralso">
   javieralso
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/224f22eebba5a0b9381242cda877fbcc?s=48" alt="gravatar"/>

</span>

      </li>
      
    

    <li>created: 2009-10-24 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2009-10-24-uboot-arm-levntate-y-anda.html">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2009-10-24-uboot-arm-levntate-y-anda.html">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/1241">node/1241</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#embedded-ref">embedded</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#embedded-ref">
        <img src="http://crysol.org/files/category_pictures/embedded.png" title="embedded" alt="embedded-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalaci√≥n local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Converting .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
    <li><a href="/recipe/2013-07-10/get-shell-user-without-shell">How to get a shell for a non-shell user</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>uBoot: "ARM, Lev√°ntate y anda" </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote><a href="http://sourceforge.net/projects/u-boot/">u-boot</a> es un bootloader libre para dispositivos empotrados de bajo poder computacional. Para los no versados en el tema, es algo as√≠ como el <emph>grub</emph> de tu PDA o de tu navegador GPS, pero con notables diferencias, claro est√°. En √©sta receta hablar√© sobre como instalarlo y como usarlo para crear distintas particiones en la memoria Flash de tu <em>handheld</em>  para, de este modo, poder instalar un sistema arrancable. Para ello, pondr√© como ejemplo la tarjeta <a href="http://www.friendlyarm.net/products/mini2440">mini2440</a> que compr√© hace unos d√≠as.</blockquote>

<!--break-->



<h2>Introducci√≥n</h2>
Como he comentado anteriormente, <em>u-boot</em> es un bootloader totalmente libre para dispositivos empotrados de bajo poder computacional. Entre sus m√∫ltiples posibilidades, est√°n las de particionar la memor√≠a flash del dispostivo en el que se encuentre corriendo, asignar nombre a dichas particiones, cargar im√°genes en RAM desde distintas fuentes, volcarlas a flash, y un largo etc√©tera....
Aqu√≠ hablar√© de las opciones que a mi juicio pueden ser mas socorridas para la instalaci√≥n de un Sistema Operativo en un dispositivo empotrado, en mi caso, tomando como ejemplo la tarjeta de desarrollo <em>mini2440</em> comentada anteriormente, aunque como es de suponer, las mismas operaciones pueden ser realizadas en distintas plataformas hardware.
As√≠ pues vamos a lo divertido del asunto ¬°¬°Empezamos!!

<h2>Instalando</h2>
El proceso de instalaci√≥n de u-boot consiste b√°sicamente en cargar una imagen de u-boot en la RAM de nuestr√° m√°quina, bien a trav√©s de su propio bootloader, bien a trav√©s de un <a href="http://es.wikipedia.org/wiki/JTAG">JTAG</a>. Una vez cargado en RAM, se lanza y se le dice que se (auto)guarde en la flash de nuestra tarjeta. En este caso y dependiendo de nuestro hardware, puede sobreescribir a su bootloader original o bien coexistir con √©l. En cualquier caso, deber√°s consultar el manual de tu tarjeta para comprobarlo.

Para el caso de la MINI2440, √©sta viene con dos memorias Flash distintas: por un lado hay una flash NOR de 2MB en la que se encuentra almacenado el bootloader espec√≠fico para los micros de Samsung (mirco de mi tarjeta de desarrollo): <em>supervivi</em>. Por otro lado, tenemos una memoria flash NAND de 128MB en la que se supone que ir√° nuestro sistema. En √©sta memoria ser√° en la que instalaremos u-boot, configurando posteriormente nuestra mini2440 para que arranque desde ah√≠ (utilizando un conmutador que a tal efecto lleva instalado).

Para comenzar, necesitaremos descargarnos tanto el c√≥digo fuente de u-boot como el software necesario para poder comunicarnos con supervivi y un compilador cruzado para <a href="http://www.arm.com">ARM</a>:

* u-boot:

<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@rigoberto:~$</span> mkdir uboot; <span class="nb">cd </span>uboot
<span class="gp">javierlaso@rigoberto:~$</span> git clone git://repo.or.cz/u-boot-openmoko/mini2440.git
</code></pre></div>
</div>

* toolchain: Compiladores cruzados para ARM los hay muchos en esto de GNU. Yo, que segu√≠ al dedillo todo lo que le√≠ en mont√≥nes de blogs, us√© el siguiente:

<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@rigoberto:~$</span> wget http://www.codesourcery.com/sgpp/lite/arm/portal/package3696/public/arm-none-linux-gnueabi/arm-2008q3-72-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2
<span class="gp">javieralso@rigoberto:~$</span> unp  arm-none-linux-gnueabi/arm-2008q3-72-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2
<span class="gp">javieralso@rigoberto:~$</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/home/rigoberto/arm-2008q3/bin
</code></pre></div>
</div>

* Friendlyarm package: Se trata de un paquete con un uploader ya compilado para comunicarse con supervivi y de una imagen ya compilada de u-boot, que deberemos utilizar para cargar la imagen que compilemos nosotros. El por qu√© de usar dos im√°genes de u-boot se explicar√° mas adelante.

<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@rigoberto:~$</span> wget http://www.kernelconcepts.de/~fuchs/micro2440/friendlyarm2440-package.tar.bz2
<span class="gp">javieralso@rigoberto:~$</span> unp friendlyarm2440-package.tar.bz2
</code></pre></div>
</div>

Una vez que lo tenemos todo descargado, empezaremos por compilar el bootloader, para ello no debemos olvidar a√±adir a nuestro PATH la ruta en la que se encuentran los binarios de la toolchain que usemos (como hicimos anteriormente). Una vez hecho esto, podemos pasar a compilar:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@rigoberto:~$</span> <span class="nb">cd </span>uboot/mini2440
<span class="gp">javieralso@rigoberto:uboot/mini2440$</span> <span class="nb">export </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-none-linux-gnueabi-
<span class="gp">javieralso@rigoberto:uboot/mini2440$</span> make mini2440_config; make
</code></pre></div>
</div>

Despu√©s de no mucho tiempo y si todo ha ido bien, deberemos tener un archivo llamado <em>u-boot.bin</em> en la carpeta donde hemos llevado a cabo la compilaci√≥n. Esa es la imagen de u-boot que se almacenar√° en la flash de nuestra tarjeta, pero para poder llevar a cabo dicho proceso, necesitaremos otra versi√≥n de u-boot (s√© que suena bastante raro, y de hecho lo es. Mas adelante explicar√© el por qu√© de ello).

Bueno, llegados a este punto, cogemos nuestra mini2440, deslizamos el conmutador superior hacia la izquierda (para configurar el arranque desde la NOR), conectamos un m√≥dem nulo desde su puerto serie a un puerto serie de nuestra m√°quina y el <em>device USB</em> a un puerto USB libre. Tras √©sto, arramcamos <em>minicom</em> y configuramos el puerto serie a 115200 Baudios, 8N1 y sin ning√∫n tipo de contol de flujo.
Hecho √©sto, solo queda encender nuestra tarjeta y comprobar que supervivi arranca:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">#</span><span class="c">#### FriendlyARM BIOS for 2440 #####</span>
<span class="go">[x] bon part 0 320k 2368k</span>
<span class="go">[v] Download vivi </span>
<span class="go">[k] Download linux kernel </span>
<span class="go">[y] Download root_yaffs image </span>
<span class="go">[c] Download root_cramfs image </span>
<span class="go">[a] Absolute User Application</span>
<span class="go">[n] Download Nboot </span>
<span class="go">[e] Download Eboot </span>
<span class="go">[i] Download WinCE NK.nb0 </span>
<span class="go">[w] Download WinCE NK.bin </span>
<span class="go">[d] Download &amp; Run </span>
<span class="go">[z] Download zImage into RAM </span>
<span class="go">[g] Boot linux from RAM </span>
<span class="go">[f] Format the nand flash </span>
<span class="go">[p] Partition for Linux </span>
<span class="go">[b] Boot the system </span>
<span class="go">[s] Set the boot parameters </span>
<span class="go">[t] Print the TOC struct of wince </span>
<span class="go">[u] Backup NAND Flash to HOST through USB(upload) </span>
<span class="go">[r] Restore NAND Flash from HOST through USB </span>
<span class="go">[q] Goto shell of vivi </span>
<span class="go">Enter your selection:</span>
</code></pre></div>
</div>

Seleccionamos la opci√≥n <em>q</em> para acceder a la shell de superivi y despu√©s le diremos que queremos cargar una imagen en la memoria y arrancar, pero para ello, antes deberemos saber cuando ocupa el bootloader que vamos a cargar (el que ya viene compilado), as√≠ que volvemos a la carpeta en la que lo descomprimimos y lo comprobamos:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@rigoberto:friendlyarm2440-package$</span> ls -l
<span class="go">.......................</span>
<span class="go">.......................</span>
<span class="go">-rwxr-xr-x   1 javieralso javieralso 239016 oct 24 11:38 u-boot.bin</span>
<span class="go">.......................</span>
<span class="go">.......................</span>
</code></pre></div>
</div>

Podemos ver que ocupa 239016 bytes. Guardamos este dato, nos ser√° util para lo que comentamos anteriormente.


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">Enter your selection:q</span>
<span class="go">Supervivi&gt; load flash 0 239016 u</span>
<span class="go">USB host is connected. Waiting a download.</span>
</code></pre></div>
</div>

Con esto le hemos dicho a supervivi que queremos cargar 239016 bytes de datos (observad que es la misma cantidad de bytes que ocupa la imagen de u-boot) en la RAM de la tarjeta. Ahora supervivi se ha quedado esperando los datos, que deberemos env√≠arselos v√≠a USB. Habiendo conectado el cable USB como se indic√≥ antes ejecutamos el uploader:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@rigoberto: friendlyarm2440-package$</span> sudo ./s3c2410_boot_usb u-boot.bin
</code></pre></div>
</div>

que deber√° ser llamado desde la carpeta <em>friendlyarm2440-package</em> y con <em>sudo</em> para poder tener acceso al puerto USB.

Si todo ha ido bien, supervivi deber√≠a mostar algo como esto:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">Now, Downloading [ADDRESS:30000000h,TOTAL:232706]</span>
<span class="go">RECEIVED FILE SIZE:  239016 (28KB/S, 8S)</span>
<span class="go">Downloaded file at 0x30000000, size = 232696 bytes</span>
<span class="go">Found block size = 0x0003c000</span>
<span class="go">Erasing...    ... done</span>
<span class="go">Writing...    ... done</span>
<span class="go">Written 239016 bytes</span>
<span class="go">Supervivi&gt; </span>
</code></pre></div>
</div>

Ahora, arrancamos u-boot:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">Supervivi&gt; go 0x30000000</span>
</code></pre></div>
</div>

y ya est√°, nuestra tarjeta arrancar√° u-boot:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">U-Boot 1.3.2-mini2440 (May 15 2009 - 21:24:49)</span>
<span class="go">I2C:   ready</span>
<span class="go">DRAM:  64 MB</span>
<span class="go">Flash:  2 MB</span>
<span class="go">NAND:  Bad block table not found for chip 0</span>
<span class="go">Bad block table not found for chip 0</span>
<span class="go">64 MiB</span>
<span class="go">*** Warning - bad CRC or NAND, using default environment</span>
<span class="go">USB:   S3C2410 USB Deviced</span>
<span class="go">In:    serial</span>
<span class="go">Out:   serial</span>
<span class="go">Err:   serial</span>
<span class="go">MAC: 08:08:11:18:12:27</span>
<span class="go">Hit any key to stop autoboot:  0 </span>
</code></pre></div>
</div>

Lo primero que ha hecho u-boot al arrancar, ha sido darnos un mensaje de alerta indicando que el contenido de la NAND no es el que debiera, ya que no est√° formateada, as√≠ que √©ste ser√° el siguiente paso:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">MINI2440 # nand scrub</span>
<span class="go">NAND scrub: device 0 whole chip</span>
<span class="go">Warning: scrub option will erase all factory set bad blocks!</span>
<span class="go">         There is no reliable way to recover them.</span>
<span class="go">         Use this command only for testing purposes if you</span>
<span class="go">         are sure of what you are doing!</span>
<span class="go">Really scrub this NAND flash? &lt;y/N&gt;</span>
<span class="go">Erasing at 0x33d4000 --  81% complete.</span>
<span class="go">NAND 64MiB 3,3V 8-bit: MTD Erase failure: -5</span>
<span class="go">Erasing at 0x3ffc000 -- 100% complete.</span>
<span class="go">Bad block table not found for chip 0</span>
<span class="go">Bad block table not found for chip 0</span>
<span class="go">OK</span>
<span class="go">MINI2440 # </span>
</code></pre></div>
</div>

La NAND tiene almacenada (o deber√≠a tener) una lista de bloques defectuosos, pero nosotros limpiaremos completamente la NAND borrando dicha lista y reconstruy√©ndola despu√©s con los bloques que nosotros detectemos como defectuosos. El comando <em>nand scrub</em> se encarga precisamente de limpiar la NAND.
Despu√©s de haber hecho la limpieza, creamos nuestra propia <em>BBT</em>:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">MINI2440 # nand createbbt</span>
<span class="go">Create BBT and erase everything ? &lt;y/N&gt;</span>
<span class="go">Skipping bad block at  0x03410000                                            </span>
<span class="go">Skipping bad block at  0x03ff0000                                            </span>
<span class="go">Skipping bad block at  0x03ff4000                                            </span>
<span class="go">Skipping bad block at  0x03ff8000                                            </span>
<span class="go">Skipping bad block at  0x03ffc000                                            </span>
<span class="go">Creating BBT. Please wait ...Bad block table not found for chip 0</span>
<span class="go">Bad block table not found for chip 0</span>
<span class="go">Bad block table written to 0x03ffc000, version 0x01</span>
<span class="go">Bad block table written to 0x03ff8000, version 0x01</span>
</code></pre></div>
</div>

√âste proceso es relativamente lento, por lo que habr√° que esperar que esperar (3-4 minutillos), as√≠ que mientras tanto, busca una tarjeta SD y copia el binario <em>u-boot.bin</em> QUE COMPILASTE en dicha tarjeta. La cargaremos desde ah√≠.

Una vez que tenemos nuestra SD con el binario cargado y que ya se ha generado la nueva BBT, introducimos la tarjeta en el lector de la mini2440 y le decimos a u-boot que la detecte:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">MINI2440 # mmcinit</span>
<span class="go">******** FIXME: Poner aqu√≠ la salida de mmcinit **************</span>
</code></pre></div>
</div>

Con la tarjeta ya detectada, cargamos <em>u-boot.bin</em> en la RAM:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">MINI2440 # fatload mmc 0:1 0x32000000 u-boot.bin</span>
<span class="go">******** FIXME: Poner aqu√≠ la salida de fatload **************</span>
</code></pre></div>
</div>

¬øQu√© ha pasado? pues que le hemos dicho a u-boot que cargue el archivo binario <em>u-boot.bin</em> desde un sistema de archivos FAT (<em>fatload</em>), ubicado en la SD (<em>mmc</em>), dispositivo 1, primera partici√≥n (<em>0:1</em>), a partir de la direcci√≥n de memoria 0x32000000.

Una vez que tenemos el archivo en RAM, lo volcamos a la NAND:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="go">MINI2440 # nand write.e 0x32000000 0x0 0x38fc4</span>
<span class="go">NAND write: device 0 offset 0x0, size 0x38fc4</span>
<span class="go">Writing data at 0x38c00 -- 100% complete.</span>
<span class="go"> 233412 bytes written: OK</span>
</code></pre></div>
</div>

Bueno, en este caso, hemos escrito 0x38fc4 bytes (233412, para que nos entendamos), al comienzo de la NAND. El numerajo hexadecimal, como hemos visto corresponde al peso de <em>u-boot.bin</em> pero √©sta vez del que hemos compilado NOSOTROS, no del que cargamos en RAM al principio. Importante no confundir √©sto. Un apunte importante es que en √©sta parte del proceso, la longitud deber√° darse en hexadecimal, no en decimal, ya que ello puede dar lugar a errores.

Por lo que he le√≠do por ah√≠, el modificador <em>.e</em> del comando <em>write</em> se utiliza para generar c√≥digos de correci√≥n de errores y evitar as√≠ lo posibles bloques defectuosos que pueda haber en la NAND (recordad el comando <em>createbbt</em> de antes).

Una vez hecho esto, podemos reiniciar tranquilos nuestra mini2440: u-boot la har√° arrancar. Aunque no har√° mucho mas ya que la NAND est√° completamente borrada y no hay sistema.

Antes coment√© que explicar√≠a el por qu√© de usar dos versiones distintas de uboot. El motivo es que para instalar uboot, primero debe residir en la RAM y poderse ejecutar desde ah√≠, ya que hay que hacer una limpieza de la NAND antes de llevar a cabo la instalaci√≥n propiamente dicha. Lo que observ√© entonces fue que las versiones de uboot que consegu√≠an arrancar desde la RAM, no eran capaces de hacerlo luego una vez que se instalaban en NAND (en efecto, seg√∫n los manuales que le√≠, una vez creada la BBT, se escrib√≠a el contenido de la RAM a la NAND, ya que all√≠ es donde est√° uboot) y viceversa, las im√°genes que si que eran capaces de arrancar desde la NAND no lo pod√≠an hacer desde la RAM. No s√© si esto es por alg√∫n bug en uboot (que deber√≠an ser entonces bugs distintos en cada una de las versiones) o porque yo hice algo mal (repet√≠ montones de veces lo que vi en tutos, blogs y dem√°s paso por paso). El caso es que despu√©s de varios intentos sin mucho √©xito, decid√≠ hacerlo tal y como lo he explicado aqu√≠.

<h2>En el futuro....</h2>
En pr√≥ximas recetas, explicar√© qu√© comandos b√°sicos utilizar en u-boot para cargar im√°genes en RAM o NAND, configurar el arranque autom√°tico desde distintas fuentes, particionar la NAND, configurar opciones de arranque para el S.O. que tengamos y alguna cosilla mas. Evito poner esa informaci√≥n aqu√≠ para no sobrecargar demas√≠ado esta receta, que se supone que tienen que ser breves y concisas.

<h2>Referencias</h2>
Muchas y muy variadas, aunque las mas importantes son √©stas.
<ul>
<li><a href=" http://www.xclusivinterior.com/index.php?title=Mini2440">Wiki sobre mini2440</a></li>
<li><a href="http://code.google.com/p/mini2440/">Hosting para proyectos sobre mini2440 en GoogleCode</a></li>
<li><a href="http://labs.kernelconcepts.de/Projects/Micro2440/">Blog con algunos art√≠culos y enlaces interesantes</a></li>
<li> Buscando en Google puedes encontrar cantidad de informaci√≥n referente a esta tarjeta de desarrollo.</li>
</ul>

      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2009-10-23/manipulacin-de-documentos-pdf-desde-python-con-pypdf" title="Manipulaci√≥n de documentos PDF desde Python, con pyPdf">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/challenge/2009-10-25/barrer-la-escoria-en-la-red" title="Barrer la escoria en la red">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Mon Sep 23 23:30:43 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

