
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>FUSE y python: crea tu propio sistema de ficheros f√°cilmente</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#int-0">
   int-0
  </a>


        
        <span class="author-photo">

  
    <img src="/assets/files/pictures/picture-8.jpg" width="48" alt="picture"/>
  

</span>

      </li>
      
      
    

    <li>created: 2011-04-08 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2011-04-08-fuse-y-python-crea-tu-propio-sistema-de-ficheros-fcilmente.html">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2011-04-08-fuse-y-python-crea-tu-propio-sistema-de-ficheros-fcilmente.html">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/1491">node/1491</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#drivers-ref">drivers</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>

  <ul>
   
   
      
        
          
          <li><a href="/recipe/2013-10-10/change-primary-monitor">Changing primary monitor</a></li>
        
      
        
          
          <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
        
      
        
          
          <li><a href="/recipe/2013-06-20/configure-wireless-rtl8723ae">Configurar tarjeta Realtek 8723AE en Debian</a></li>
        
      
        
          
          <li><a href="/recipe/2013-02-10/altavoces-bluetooth-en-gnome">Altavoces bluetooth en GNOME</a></li>
        
      
        
          
          <li><a href="/recipe/2011-07-01/apple-wireless-keyboard-con-debian">Apple Wireless Keyboard con Debian</a></li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
   
  </ul>

  
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2014-09-28/nautilus-sort-directories-first">Nautilus: list folder before files</a></li>
  
    <li><a href="/recipe/2014-05-27/vagrant-multi-machine">multi machine Vagrantfile</a></li>
  
    <li><a href="/recipe/2014-05-20/veewee-on-debian">Installing veewee on Debian sid</a></li>
  
    <li><a href="/recipe/2014-05-19/latex-packages">Useful LaTeX packages and their main commands</a></li>
  
    <li><a href="/recipe/2014-01-22/run-until-fails">Keep repeating a command until it fails</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>FUSE y python: crea tu propio sistema de ficheros f√°cilmente </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote>Buenas!Hace un par de d√≠as, en uno de mis ratos libres se me ocurri√≥ buscar informaci√≥n sobre c√≥mo crear tu propio sistema de ficheros para Linux (si, el kernel). En los nomerosos foros comentaban que era algo muy d√≠ficil y que requer√≠a mucho tiempo y esfuerzo. Bien, esto es verdad... pero tambi√©n es verdad que no tenemos porqu√© enfrentarnos al problema en todo su esplendor. Existe un modulito para los Linux 2.4 y 2.6 que permite montar sistemas de ficheros en espacio de usuario. Esta receta explicar√° como crearnos nuestro propio <em>filesystem</em> para montarse mediante <em>fuse</em> y para ello nada mejor que crearnos nuestro propio FS.</blockquote>

<h2>Qu√© es <em>FUSE</em></h2>
Inicialmente <em>FUSE</em> era un componente de <em>AFS</em>. Finalmente se desarroll√≥ como componente independiente y <em>AFS</em> se convirti√≥ en un m√≥dulo de <em>AFS</em>.

<em>FUSE</em> se compone de un m√≥dulo que se carga en el kernel y una biblioteca que facilita el acceso al mismo. Adem√°s, para desarrollar m√≥dulos en un determinado lenguaje debe existir un <em>wrapper</em> para dicho lenguaje. Afortunadamente para nosotros existe uno para <em>python</em>, en Debian y similares:

<div class="console">
<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> sudo aptitude install python-fuse</code></pre></div>
</div>

A la hora de utilizar un FS determinado <em>FUSE</em> se encargar√° de realizar todas las tareas comunes y cuando haya que realizar algo espec√≠fico de nuestro FS se invocar√° a alguno de los m√©todos escritos por nosotros.

<em>FUSE</em> est√° dise√±ado para ofrecer soporte absoluto a FS's que cumplan <em>todas</em> las normas <em>Posix</em>. Evidentemente no es necesario para el funcionamiento de cualquier FS que se implementen <em>todas</em> esas funciones (como veremos m√°s adelante), as√≠ que si alguna acci√≥n no la hemos implementado <em>FUSE</em> se las arreglar√° con lo que tenga. Si finalmente no se puede realizar la acci√≥n se eleva un error que nos mostrar√° el sistema operativo (por ejemplo: sistema de ficheros de s√≥lo lectura).

<h2>Nuestro sistema de ficheros</h2>
Nosotros vamos a crear un sistema de ficheros con las siguientes caracter√≠sticas:
<ul><li><b>NO</b> es persistente, es decir: cuando desmontemos volar√°n todos los datos.</li>
<li><b>NO</b> soportar√° gesti√≥n de permisos.</b></li>
<li><b>NO</b> soportar√° fechas (ni de creaci√≥n, modificaci√≥n, etc.)</b></li>
<li><b>NO</b> permitir√° enlaces simb√≥licos.</li></ul>

Vaya guarrer√≠a de sistema de ficheros... ¬°pues claro! la primera versi√≥n est√° escrita en unas horas de tiempo libre adem√°s pretende ser <em>muy</em> simple para que sirva de ejemplo. Nosotros implementaremos lo siguiente:
<ul><li>Creaci√≥n/eliminaci√≥n de directorios</li>
<li>Creaci√≥n/eliminaci√≥n de ficheros</li>
<li>Modificaci√≥n de ficheros</li>
<li>Mover/renombrar ficheros y directorios</li>
<li>Nivel de anidamiento ilimitado (te√≥rico, claro)</li></ul>

¬øC√≥mo implementaremos nuestro FS? pues de una forma muy simple: un directorio ser√° un diccionario en python, la clave ser√° el nombre (del fichero o directorio) y el valor ser√°:
<ul><li>Una cadena si se trata de un fichero</li>
<li>Otro diccionario si se trata de un subdirectorio</li></ul>

<h2>C√≥mo escribir un m√≥dulo para <em>FUSE</em></h2>
Bueno, nuestros m√≥dulos van a ser ejecutables que aceptar√°n opciones similares a <em>mount</em> y mediante los cuales podremos montar directamente nuestro FS en la estructura de directorios de nuestro sistema.

A la hora de depurar nuestro FS deb√©is saber que los <em>print</em> no se van a mostrar por pantalla (se acab√≥ la depuraci√≥n por <em>chivatos</em>) y que las excepciones no capturadas se las comer√° <em>FUSE</em> y como mucho obtendremos por consola un <em>"imposible hacer XXX: argumento no v√°lido"</em>. As√≠ que puede ser una buena tarea estudiar un poquito el m√≥dulo <em>logging</em> de <em>python</em> ;).

A la hora de implementar los m√©todos a los que invocar√° <em>FUSE</em> tenemos tres opciones:
<ul><li>No escribir el m√©todo: se elevar√° una excepci√≥n que capturar√° <em>FUSE</em> y obtendremos un mesaje similar a <em>"imposible hacer XXX: no implementado"</em>.</li>
<li>Escribir un m√©todo hueco que devuelva <em>error</em>: obtendremos el mensaje de antes, sin embargo nos resultar√° √∫til para saber qu√© acciones en el FS ocasionan llamadas a unos m√©todos u otros (cosa que supongo podr√≠amos ver estudiando c√≥digo y documentaci√≥n).</li>
<li>Implementar el m√©todo y que devuelva un valor correcto o error en caso de fallo: cuantos m√°s de estos tengamos, mejor ser√° nuestro FS :D.</li></ul>

La clase principal, la que utilizar√° <em>FUSE</em> deber√° heredar de la clase <em>Fuse</em> y cuando creemos una instacia de nuestro FS le pasaremos unos par√°metros que indicar√°n a <em>FUSE</em> la clase de FS que va a manejar, si el m√≥dulo permite acceso concurrente, c√≥mo debe tratar el car√°cter de separaci√≥n de directorios, etc.

As√≠ de buenas a primeras el esqueleto de aplicaci√≥n <em>FUSE</em> podr√≠a ser como sigue:


<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">fuse</span>
<span class="kn">from</span> <span class="nn">fuse</span> <span class="kn">import</span> <span class="n">Fuse</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fuse</span><span class="p">,</span> <span class="s">&#39;__version__&#39;</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> \
        <span class="s">&quot;python-fuse doesn&#39;t know of fuse.__version__, probably it&#39;s too old.&quot;</span>
<span class="n">fuse</span><span class="o">.</span><span class="n">fuse_python_api</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c"># My FS, only stored in memory :P</span>
<span class="c">#</span>
<span class="k">class</span> <span class="nc">DictFS</span><span class="p">(</span><span class="n">Fuse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Fuse</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c"># Root dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Userspace filesystem example</span>

<span class="s">&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">Fuse</span><span class="o">.</span><span class="n">fusage</span>
    
    <span class="n">fs</span> <span class="o">=</span> <span class="n">DictFS</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;%prog&#39;</span> <span class="o">+</span> <span class="n">fuse</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                <span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span>
                <span class="n">dash_s_do</span><span class="o">=</span><span class="s">&#39;setsingle&#39;</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">errex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></div>
</div>

Como v√©is en el constructor nos hemos creado el directorio ra√≠z de nuestro FS. Si no hubi√©semos necesitado nada, podr√≠amos habernos ahorrado el m√©todo completo.

<h2>Entradas de directorio y atributos</h2>
Como ya sab√©is, una entrada de directorio en nuestro FS ser√° un fichero o un directorio. Cada vez que <em>FUSE</em> entre en un directorio o vaya a leer un fichero, preguntar√° primero por sus atributos. Para ello invocar√° al m√©todo <em>getstats(path)</em> de nuestra clase y le pasar√° la ruta <em>ruta completa</em> dentro de nuestro FS. El ra√≠z de nuestro FS ser√° '/' que no tiene porqu√© coincidir con el '/' de nuestro sistema. Este m√©todo es b√°sico en nuestro FS y debe retornar un objeto de tipo <em>fuse.stats</em>.

Podemos crearnos nosotros nuestra propia clase de atributos:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">MyStat</span><span class="p">(</span><span class="n">fuse</span><span class="o">.</span><span class="n">Stat</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_ino</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_dev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_uid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_gid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_atime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_ctime</span> <span class="o">=</span> <span class="mi">0</span></code></pre></div>
</div>

Vamos a hacer esto porque en nuestro ejemplo siempre vamos a devolver un objeto de estos, pero modificando algunos atributos seg√∫n sea el caso.
<h3>Atributos de directorio</h3>
Cambiaremos los siguientes valores:
<ul><li>st_mode  = stat.S_IFDIR | 0755 (recordad que deben ser ejecutables)</li>
<li>st_nlink = 2 (numero de enlaces al fichero, debe ser distinto de 0, en directorios se usa 2)</li></ul>

El resto de par√°metros podemos dejarlos intactos, ya hemos dicho que no trataremos al due√±o del fichero ni las fechas de modificacion, acceso, etc. Adem√°s, para los directorios se asumen que tienen tama√±o 0.

<h3>Atributos de archivo</h3>
Ahora los valores ser√°n:
<ul><li>st_mode = stat.S_IFREG | 0666 (as√≠ impedimos ejecuci√≥n de ficheros en nuestro FS)</li>
<li>st_link = 1 (en nuestro FS siempre ser√° 1, 0 indicar√≠a archivo borrado)</li>
<li>st_size = <em>longitud del fichero (de la cadena en nuestro caso)</em></li></ul>

<h2>Nuestas funciones auxiliares</h2>
Bueno, lo suyo es que si nos hacemos un FS nos hagamos una clase a parte que implemente nuestro FS y el modulito de <em>FUSE</em> sirva de <em>wrapper</em> entre nuestra clase y el <em>FUSE</em>. Pero bueno, voy a pasar y como queremos un ejemplo <em>simple</em> lo metemos todo en la misma clase. Un ejemplo de esto ser√°n las funciones auxiliares que nos vamos a crear.

La principal es <em>__get_dir(path)</em> que, siendo <em>path</em> una lista de elementos (nombres de directorio), <em>caminar√°</em> desde el diccionario <em>root</em> hasta llegar al √∫ltimo elemento de la lista (directorio hoja) y nos lo devolver√°.

Los m√©todos <em>__join_path(path)</em> y <em>__path_list(path)</em> convierten una lista de elementos en una cadena del tipo <em>"/elemento1/elemento2"</em> y viceversa (si, conozco <em>os.path.join()</em> y tal pero prefer√≠ escribirlos yo).

Por √∫ltimo est√° <em>__navigate(path)</em>. Este m√©todo nos resultar√° muy √∫til porque cada vez que <em>FUSE</em> se refiere a un elemento de nuestro FS lo hace utilizando la ruta completa dentro de nuestro FS. As√≠, si nos indicase <em>"/dir1/dir2/elemento1"</em>, este m√©todo nos devolver√≠a el directorio <em>dir2</em> y el nombre de <em>elemento1</em>. Como ver√©is m√°s adelante, esto nos har√° todo el trabajo.

El c√≥digo de las funciones es el siguiente, no hay mucho m√°s que comentar sobre ellas:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Return string path as list of path elements</span>
    <span class="k">def</span> <span class="nf">__path_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">raw_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">raw_path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="c"># Return list of path elements as string</span>
    <span class="k">def</span> <span class="nf">__join_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">joined_path</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">joined_path</span> <span class="o">+=</span> <span class="p">(</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">joined_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c"># Return dict of a given path</span>
    <span class="k">def</span> <span class="nf">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__path_list</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Walk over files?</span>
                    <span class="k">return</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Walk over non-existent dirs?</span>
                <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">level</span>

    <span class="c"># Return dict of a given path plus last name of path</span>
    <span class="k">def</span> <span class="nf">__navigate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__path_list</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c"># Get level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__join_path</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">level</span><span class="p">,</span> <span class="n">entry</span></code></pre></div>
</div>

<h2>Los m√©todos propios de nuestro FS</h2>
Bien, ya tenemos todos los ingredientes, pero si ahora intent√°semos montar un directorio con nuestro m√≥dulo nos dar√≠a error porque <em>FUSE</em> no ser√≠a capaz de leer el directorio ra√≠z de nuestro FS. La primera llamada que intenta <em>FUSE</em> es: <em>getattr('/')</em> as√≠ pues, lo primero que tenemos que implementar es ese m√©todo:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">MyStat</span><span class="p">()</span>

        <span class="c"># Ask for root dir</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span><span class="p">:</span>
            <span class="c">#return self.root.stats</span>
            <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFDIR</span> <span class="o">|</span> <span class="mo">0755</span>
            <span class="n">st</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">st</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="c"># Entry found</span>
            <span class="c"># is a directory?</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFDIR</span> <span class="o">|</span> <span class="mo">0755</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="n">st</span>
            <span class="c"># is a file?</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFREG</span> <span class="o">|</span> <span class="mo">0666</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">st</span>

        <span class="c"># File not found</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span></code></pre></div>
</div>
Este m√©todo creo que es un poco <em>spaguetti</em> porque el caso especial del <em>root</em> realmente no existir√≠a. A parte de esto el funcionamiento es simple: creamos un objeto <em>stats</em>. Cuando nos preguntan por un elemento, si existe y es un directorio (un diccionario) ponemos unos valores a los atributos y lo retornamos. Si era un archivo (una cadena) pues ponemos otros valores y lo retornamos. Si la funci√≥n no retorna nada obtendremos un <em>par√°metro inv√°lido</em> y la operaci√≥n sobre nuestro FS fallar√°. Si retornamos <em>-errno.ENOENT</em> obtendremos un <em>fichero no encontrado</em>.

<h2>Operaciones con directorios</h2>
Ahora mismo ya podr√≠amos montar nuestro FS, pero un simple <em>ls</em> sobre √©l nos dar√≠a error. Ahora hay que implementar tres operaciones para poder listar, crear y borrar directorios: <em>readdir(path, offset)</em>, <em>mkdir(path, mode)</em> y <em>rmdir(path)</em> respectivamente.


<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">readdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="n">file_entries</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">]</span>

        <span class="c"># Get filelist</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">file_entries</span> <span class="o">+=</span> <span class="n">level</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">file_entries</span> <span class="o">=</span> <span class="n">file_entries</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">file_entries</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">fuse</span><span class="o">.</span><span class="n">Direntry</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code></pre></div>
</div>
Este m√©todo recibe el <em>path</em> sobre el que obtener el contenido y un <em>offset</em> que indica cual es el primer elemento de la lista a devolver (en todas mis pruebas siempre val√≠a 0). Como v√©is hay que a√±adir a pelo los directorios "," (por eso en directorios st_nlink = 2) y el enlace al padre (esto es: ".."). En vez de retornar una lista pasamos directamente el iterador. Usamos un m√©todo de <em>python-fuse</em> que construye una entrada de directorio a partir del nombre.

Con este m√©todo podremos hacer ahora <em>ls</em> en nuestro FS que no dar√° error... pero claro, tampoco mostrar√° nada porque nuestro FS est√° vac√≠o... Vamos a permitir la creaci√≥n de directorios, para ello implementamos el siguiente m√©todo:


<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">mkdir</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Make new dir</span>
        <span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></code></pre></div>
</div>

Es tan f√°cil que no hay nada que explicar... ;) Si ahora montamos nuestro FS (al final ten√©is un ejemplo de c√≥mo) ver√©is que podemos crear directorios, ir a ellos y listarlos... ¬°todo un avance! Si intentamos borrarlos... ¬°fail! as√≠ que a√±adimos esa posibilidad:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">rmdir</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="c"># Delete entry</span>
        <span class="k">del</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span></code></pre></div>
</div>
Ahora tambi√©n podremos hacer <em>rmdir</em> o <em>rm</em> sobre un directorio... pero cuidado que si un directorio no est√° vac√≠o, se eliminar√° tambi√©n (aqu√≠ no comprobamos que no lo est√©). No es demasiado grave puesto que <em>python</em> tiene <em>garbage collector</em> y no se nos quedar√°n por ah√≠ directorios sin enlazar ocupando memoria...

<h2>Operaciones con ficheros</h2>
Bien, ya podemos trabajar con directorios como con cualquier otro FS... pero... ¬øy los ficheros? estos son bastante m√°s chicha...

Si mont√°is nuestro FS y hac√©is un <em>touch</em> os dar√° un <em>unimplemented error</em>, nos hacen falta dos m√©todos (adem√°s del <em>getstat()</em>) para poder realizarlo: <em>mknod(path, mode, dev)</em> y <em>open(path, flags)</em>. El primero crear√° el enlace y el segundo intentar√° abrirlo (aunque luego no realice operaciones sobre √©l). Estas dos operaciones no deben devolver error (o elevar una excepci√≥n) para que <em>touch</em> funcione. La primera es bastante sencilla:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">mknod</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dev</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Make empty file</span>
        <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span></code></pre></div>
</div>

Nuestro m√©todo no retornar√° nada (ni elevar√° ninguna excepci√≥n) lo cual indicar√° a <em>FUSE</em> que todo ha ido bien. Del modo de creaci√≥n pasamos completamente (ya que no mantenemos un objeto <em>stats</em> por cada elemento del FS). El par√°metro <em>dev</em> es un identificador interno del kernel que representa al manejador de dispositivo asociado al FS... tambi√©n pasaremos de √©l :).

El segundo m√©todo tampoco es complicado:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">open</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">flags</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span></code></pre></div>
</div>
S√≠mplemente verificamos que exista o no el fichero. Daos cuenta que en un FS real esto es m√°s complicado puesto que deber√≠amos comprobar los flags con los permisos del fichero. Tambi√©n mantendr√≠amos una lista de ficheros abiertos si quisi√©ramos controlar la concurrencia, etc.

En este momento el <em>touch</em> crear√≠a ficheros vac√≠os... pero despu√©s dar√≠a un error extra√±o. ¬°Pues claro! porque hemos implementado el <em>open()</em> pero no el <em>close()</em>... que en este caso se llama <em>release(path)</em>:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">release</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">flags</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span></code></pre></div>
</div>
Todo lo dicho para el <em>open()</em> es v√°lido ahora para <em>release()</em> as√≠ que poco m√°s que comentar.

En este punto ya podemos trabajar con directorios en nuestro FS y crear archivos vac√≠os con <em>touch</em>... pero si creamos un fichero con <em>emacs</em> por ejemplo y le damos a guardar... ¬°error! pues claro... para leer y escribir de un fichero necesitamos dos m√©todos nuevos: <em>read(path, length, offset)</em> y <em>write(path, buf, offset)</em>.

La funci√≥n <em>read()</em> debe retornar un <em>buffer</em> (una cadena, <em>en python</em>) de <b>como mucho</b> <em>length</em> bytes, le√≠dos del elemento <em>path</em> a partir del byte <em>offset</em>. O dicho en <em>python√©s</em>:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">read</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="c"># Check ranges</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
            <span class="c"># Fix size</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">file_size</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Invalid range returns no data, instead error!</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">buf</span></code></pre></div>
</div>
El m√©todo es bastante simple, pero hay que tener cuidado con los rangos y dem√°s. Con el m√©todo <em>write()</em> tenemos menos problemas:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">write</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">offset</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Write data into file</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]))</span>
        <span class="c"># This operation could be truncate the file!!</span>
        <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">][:</span><span class="n">offset</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        
        <span class="c"># Return written bytes</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span></code></pre></div>
</div>

¬°Y listo! ya podemos leer y escribir dentro de los ficheros de nuestro FS... ahora abrimos un fichero existente, le a√±adimos algunos bytes, le damos a aguardar y... ¬°¬°error!! ¬øy esto? pues... ¬øqu√© va a ser? esa operaci√≥n tambi√©n hay que implementarla y se llama <em>truncate(path, size)</em>: permite modificar el tama√±o de un fichero existente. El m√©todo es sencillo: truncar la cadena o concatenarla seg√∫n sea necesario...


<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">truncate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">size</span> <span class="p">):</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="c"># Truncate file to specified size</span>
            <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">][:</span><span class="n">size</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Add more bytes</span>
            <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]))</span></code></pre></div>
</div>

Y ahora s√≠... montad el FS y perrear con √©l... ver√©is que <em>casi</em> todo funciona. ¬øTodo? pues si intent√°is mover/renombrar un fichero o directorio... ¬°¬°FAIL!!... a√∫n nos queda un m√©todo m√°s: <em>rename(oldPath, newPath)</em>. Implementar el movimiento/renombrado de ficheros en nuestro FS tampoco es muy dif√≠cil :P. A ver qu√© os parece:

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">rename</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">oldPath</span><span class="p">,</span> <span class="n">newPath</span> <span class="p">):</span>
        <span class="n">oldLevel</span><span class="p">,</span> <span class="n">oldFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">oldPath</span><span class="p">)</span>

        <span class="c"># Can&#39;t use __navigate() because newPath-filename not exists</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__path_list</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
        <span class="n">newFilename</span> <span class="o">=</span> <span class="n">newPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">newLevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__join_path</span><span class="p">(</span><span class="n">newPath</span><span class="p">))</span>

        <span class="c"># Make new link</span>
        <span class="n">newLevel</span><span class="p">[</span><span class="n">newFilename</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldLevel</span><span class="p">[</span><span class="n">oldFilename</span><span class="p">]</span>

        <span class="c"># Remove old</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">oldPath</span><span class="p">)</span></code></pre></div>
</div>
Tampoco hay mucho que comentar as√≠ que ya os dejo de dar la lata... ¬°ahora a probarlo!

<h2>Probando el invento</h2>
Supongamos que hab√©is creado el archivo <em>dictfs.py</em> con permisos de ejecuci√≥n y toda la pesca. Si est√°is en el grupo de <em>FUSE</em> o sois <em>sudoers</em>:

<div class="console">
<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> mkdir mymnt
<span class="gp">$</span> sudo ./dictfs.py mymnt/</code></pre></div>
</div>

Y ya est√°... ¬°montadito! (hombres de poca f√©, tecleen <em>mount</em> para verificarlo!). Para desmontar pues el <em>umount</em> de toda la vida ;)

<h2>El c√≥digo completo</h2>
Bueno, tengo el ejemplo en <a href="https://github.com/int-0/sillygames">mi github</a> pero aqu√≠ os voy a copiar la versi√≥n inicial (supongo que si actualizo, tambi√©n lo har√© aqu√≠):

<div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># Released under GPLv3 license</span>
<span class="c"># Read full text at: gnu.org/licenses/gpl-3.0.html</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">errno</span>

<span class="kn">import</span> <span class="nn">fuse</span>
<span class="kn">from</span> <span class="nn">fuse</span> <span class="kn">import</span> <span class="n">Fuse</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fuse</span><span class="p">,</span> <span class="s">&#39;__version__&#39;</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> \
        <span class="s">&quot;python-fuse doesn&#39;t know of fuse.__version__, probably it&#39;s too old.&quot;</span>
<span class="n">fuse</span><span class="o">.</span><span class="n">fuse_python_api</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">LOG_FILENAME</span> <span class="o">=</span> <span class="s">&#39;dictfs.log&#39;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">LOG_FILENAME</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c"># Only make one of this whe getstat() is called. Real FS has one per entry (file</span>
<span class="c"># or directory).</span>
<span class="c">#</span>
<span class="k">class</span> <span class="nc">MyStat</span><span class="p">(</span><span class="n">fuse</span><span class="o">.</span><span class="n">Stat</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_ino</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_dev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_uid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_gid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_atime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_ctime</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c"># My FS, only stored in memory :P</span>
<span class="c">#</span>
<span class="k">class</span> <span class="nc">DictFS</span><span class="p">(</span><span class="n">Fuse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Fuse</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c"># Root dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># Return string path as list of path elements</span>
    <span class="k">def</span> <span class="nf">__path_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">raw_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">raw_path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="c"># Return list of path elements as string</span>
    <span class="k">def</span> <span class="nf">__join_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">joined_path</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">joined_path</span> <span class="o">+=</span> <span class="p">(</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">joined_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c"># Return dict of a given path</span>
    <span class="k">def</span> <span class="nf">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__path_list</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Walk over files?</span>
                    <span class="k">return</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Walk over non-existent dirs?</span>
                <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">level</span>

    <span class="c"># Return dict of a given path plus last name of path</span>
    <span class="k">def</span> <span class="nf">__navigate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c"># Path analysis</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__path_list</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c"># Get level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__join_path</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">level</span><span class="p">,</span> <span class="n">entry</span>

    <span class="c">### FILESYSTEM FUNCTIONS ###</span>

    <span class="k">def</span> <span class="nf">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">MyStat</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** getattr(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c"># Ask for root dir</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span><span class="p">:</span>
            <span class="c">#return self.root.stats</span>
            <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFDIR</span> <span class="o">|</span> <span class="mo">0755</span>
            <span class="n">st</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">st</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="c"># Entry found</span>
            <span class="c"># is a directory?</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFDIR</span> <span class="o">|</span> <span class="mo">0755</span> <span class="c"># rwx r-x r-x</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** getattr_dir_found: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">st</span>
            <span class="c"># is a file?</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFREG</span> <span class="o">|</span> <span class="mo">0666</span> <span class="c"># rw- rw- rw-</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">st</span><span class="o">.</span><span class="n">st_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** getattr_file_found: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">st</span>

        <span class="c"># File not found</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** getattr_entry_not_found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

    <span class="k">def</span> <span class="nf">readdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** readdir(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>       

        <span class="n">file_entries</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">]</span>

        <span class="c"># Get filelist</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Get all directory entries</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">file_entries</span> <span class="o">+=</span> <span class="n">level</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">file_entries</span> <span class="o">=</span> <span class="n">file_entries</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">file_entries</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">fuse</span><span class="o">.</span><span class="n">Direntry</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mkdir</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** mkdir(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Make new dir</span>
        <span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">mknod</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dev</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** mknod(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dev</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Make empty file</span>
        <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># This method could maintain opened (or locked) file list and,</span>
    <span class="c"># of course, it could check file permissions.</span>
    <span class="c"># For now, only check if file exists...</span>
    <span class="k">def</span> <span class="nf">open</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">flags</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** open(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="c"># No exception or no error means OK</span>

    <span class="c"># In this example this method is the same as open(). This method</span>
    <span class="c"># is called by close() syscall, it&#39;s means that if open() maintain</span>
    <span class="c"># an opened-file list, or lock files, or something... this method</span>
    <span class="c"># must do reverse operation (refresh opened-file list, unlock files...</span>
    <span class="k">def</span> <span class="nf">release</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">flags</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** release(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

    <span class="k">def</span> <span class="nf">read</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** read(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="c"># Check ranges</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
            <span class="c"># Fix size</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">file_size</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Invalid range returns no data, instead error!</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">buf</span>

    <span class="k">def</span> <span class="nf">rmdir</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** rmdir(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="c"># Delete entry</span>
        <span class="k">del</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">truncate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">size</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** truncate(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="c"># Truncate file to specified size</span>
            <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">][:</span><span class="n">size</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Add more bytes</span>
            <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">unlink</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** unlink(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># File exists?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>

        <span class="c"># Remove entry</span>
        <span class="k">del</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">write</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">offset</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** write(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">offset</span><span class="p">)</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Write data into file</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]))</span>
        <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="n">filename</span><span class="p">][:</span><span class="n">offset</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        
        <span class="c"># Return written bytes</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rename</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">oldPath</span><span class="p">,</span> <span class="n">newPath</span> <span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;*** rename(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">oldPath</span><span class="p">,</span> <span class="n">newPath</span><span class="p">)</span>

        <span class="n">oldLevel</span><span class="p">,</span> <span class="n">oldFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__navigate</span><span class="p">(</span><span class="n">oldPath</span><span class="p">)</span>
        <span class="c"># Can&#39;t use __navigate() because newPath-filename not exists</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__path_list</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
        <span class="n">newFilename</span> <span class="o">=</span> <span class="n">newPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">newLevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__join_path</span><span class="p">(</span><span class="n">newPath</span><span class="p">))</span>

        <span class="c"># Make new link</span>
        <span class="n">newLevel</span><span class="p">[</span><span class="n">newFilename</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldLevel</span><span class="p">[</span><span class="n">oldFilename</span><span class="p">]</span>

        <span class="c"># Remove old</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">oldPath</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Userspace filesystem example</span>

<span class="s">&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">Fuse</span><span class="o">.</span><span class="n">fusage</span>
    
    <span class="n">fs</span> <span class="o">=</span> <span class="n">DictFS</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;%prog&#39;</span> <span class="o">+</span> <span class="n">fuse</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                <span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span>
                <span class="n">dash_s_do</span><span class="o">=</span><span class="s">&#39;setsingle&#39;</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">errex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></div>
</div>

Va con comentarios del director y <em>logging</em>, muy √∫til... ;)

<h2>Enlaces interesantes</h2>
<ul><li><a href="http://fuse.sourceforge.net/">http://fuse.sourceforge.net/</a></li>
<li><a href="http://www.ibm.com/developerworks/linux/library/l-fuse/">http://www.ibm.com/developerworks/linux/library/l-fuse/</a></li>
<li><a href="http://sourceforge.net/apps/mediawiki/fuse/index.php?title=FUSE_Python_tutorial">http://sourceforge.net/apps/mediawiki/fuse/index.php?title=FUSE_Python_tutorial</a></li>
<li>/usr/share/doc/python-fuse/examples/</li></ul>

      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/2011-04-07/antiprogramacin" title="Antiprogramaci√≥n">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/2011-04-12/atajos-en-bash" title="Atajos en bash">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2014 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/web.source" target="_blank">site sources</a>.
	  <br/>
	  Generated at 2014-09-28 21:06:58 +0200
	</p>
      </footer>

    </div>

    
  </body>
</html>

