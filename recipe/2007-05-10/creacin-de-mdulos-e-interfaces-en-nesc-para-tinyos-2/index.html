
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Creación de módulos e interfaces en nesC para TinyOS 2</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#javieralso">
   javieralso
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/224f22eebba5a0b9381242cda877fbcc?s=48" alt="gravatar"/>

</span>

      </li>
      
    

    <li>created: 2007-05-10 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2007-05-10-creacin-de-mdulos-e-interfaces-en-nesc-para-tinyos-2.html">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2007-05-10-creacin-de-mdulos-e-interfaces-en-nesc-para-tinyos-2.html">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/677">node/677</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#embedded-ref">embedded</a>
    
      <a href="/tags.html#Arco-ref">Arco</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#embedded-ref">
        <img src="http://crysol.org/files/category_pictures/embedded.png" title="embedded" alt="embedded-icon"/>
     </a>
     
  
     
     
     <a class="tag-icon" href="/tags.html#Arco-ref">
        <img src="http://crysol.org/files/category_pictures/arco_3D_taxonomy.png" title="Arco" alt="Arco-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalación local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-10-05/virtualbox-import-export-clone">VirtualBox: import/export and cloning machines</a></li>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Converting .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Creación de módulos e interfaces en nesC para TinyOS 2 </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote>Después de pelearme con <a href="http://crysol.inf-cr.uclm.es/node/405"><b>tinyOS</b></a> he conseguido comprender mas o menos como va el tema de los módulos y <em>wiring</em> (conexionado lógico entre módulos). Aquí dejo un ejemplo muy básico y la explicación que ilustra lo suficiente para poder comenzar a hacer cosillas.</blockquote>


<h2>Introducción</h2>

tinyOS se basa en el uso de módulos que se "cablean" (<em>wiring</em>) entre sí para dar lugar a la aplicación en sí. Este cableado se lleva a cabo en lo que se conoce como <em>configuraciones</em> y podemos tener montones de configuraciones distintas para una misma aplicación. De este modo, podemos conseguir que una misma aplicación pueda correr en distintas arquitecturas hardware sin apenas tocar código, solo modificando las configuraciones, lo que hará que se utilicen unos módulos u otros que se encargan del control a mas bajo nivel.

Básicamente, aquí hablaré de:
<ul>
  <li>Módulos</li>
  <li>Interfaces</li>
  <li>Configuraciones</li>
</ul>

Todo el código de ejemplo que se usa en esta receta puede descargarse, vía subversión, del repositorio público de <a href="thhp://arco.inf-cr.uclm.es"><b>ARCO</b></a> de la siguiente forma:


<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@richie:~$</span> svn co https://arco.inf-cr.uclm.es/svn/public/prj/tinyOS 
</code></pre></div>
</div>

y con ésto ya podremos seguir todos los ejemplos dados a continuación.

<h2>Interfaces</h2>

Las <em>interfaces</em> se pueden definir como la parte "visible" de los módulos. No se puede acceder a ninguna función de un módulo si antes no ha sido definida en una interfaz.
Una interfaz puede ser provista por varios módulos distintos. Por ejemplo, podemos tener una interfaz de comunicaciones que abstraiga los procedimientos de envío y recepción de mensajes y varios módulos que hagan uso de esa interfaz, uno para cada tipo de hardware subyacente (por ejemplo no se maneja igual el hardware de comunicaciones de una <em>mica2</em> que el de una <em>telos</em>). Los métodos serán los mismos y se llamarán igual (la interfaz es la misma), pero la implementación interna puede ser totalmente distinta. Nosotros lo veremos como una caja negra.

En nuestro ejemplo se utilizan dos interfaces: <b>interfaz2</b>, en el archivo <em>interfaz2.nc</em> e <b>interfazPRB</b> en el archivo <em>interfazPRB.nc</em>. Las implementaciones son las que siguen:


<div>
<div class="highlight"><pre><code class="c"><span class="n">interface</span> <span class="n">interfaz2</span> <span class="p">{</span>
  <span class="n">command</span> <span class="kt">void</span> <span class="n">i2c1</span><span class="p">();</span>
  <span class="n">command</span> <span class="kt">uint16_t</span> <span class="nf">i2c2</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">);</span>
  <span class="n">command</span> <span class="kt">uint16_t</span> <span class="nf">i2c3</span><span class="p">(</span><span class="kt">char</span> <span class="n">d</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

para <em>interfaz2.nc</em> y


<div>
<div class="highlight"><pre><code class="c"><span class="n">interface</span> <span class="n">interfazPRB</span> <span class="p">{</span>
  <span class="n">command</span> <span class="kt">void</span> <span class="n">comando1</span><span class="p">();</span>
  <span class="n">command</span> <span class="kt">int</span> <span class="nf">comando2</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

para <em>interfazPRB.nc</em>

Bueno. Se puedes ver, escribir una un interfaz es bastante simple. Lo único que hay que hacer es especificar el nombre de la y los comandos de que consta. Estos comandos son los prototipos (como se llama en <em>ANSI C</em>) de las funciones precedidos de la palabra reservada <b>command</b>. Si quisiesesmos declarar <em>señales</em>, utilizariamos el modificador <b>signal</b>. El nombre del archivo debe de ser el mismo que el del interfaz, respetando las mayúsculas y con extensión <em>.nc</em>. 

<h2>Módulos</h2>

Los módulos implementan bloques funcionales generalmente de un nivel de abstracción más bajo que el bloque que los referencia. Un mismo módulo puede proveer varias interfaces y por lo tanto puede implementar distintas funcionalidades (Por ejemplo el módulo <em>AMSender</em> provee las interfaces <em>Packet</em>, <em>AMPacket</em>, <em>AMSend</em>, etc...). Lo lógico es que todos los conjuntos de funciones (interfaces) que implementa un módulo guarden algún tipo de relación.

En nuestro caso, utilizamos dos módulos: <em>modulo2C</em>, implementado en <b>modulo2C.nc</b> y <em>moduloC</em> implementado en <b>moduloC.nc</b>.
Éste es el contenido de los archivos:


<div>
<div class="highlight"><pre><code class="c"><span class="n">module</span> <span class="n">modulo2C</span> <span class="p">{</span>
  <span class="n">provides</span> <span class="p">{</span>
    <span class="n">interface</span> <span class="n">interfaz2</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">      Única interfaz proporcionada por el módulo </span>
<span class="cm">    */</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">implementation</span>
<span class="p">{</span>
  <span class="n">command</span> <span class="kt">void</span> <span class="n">interfaz2</span><span class="p">.</span><span class="n">i2c1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v1</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">v1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">command</span> <span class="kt">uint16_t</span> <span class="n">interfaz2</span><span class="p">.</span><span class="n">i2c2</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">command</span> <span class="kt">uint16_t</span> <span class="n">interfaz2</span><span class="p">.</span><span class="n">i2c3</span><span class="p">(</span><span class="kt">char</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

para <em>modulo2C</em> y 


<div>
<div class="highlight"><pre><code class="c"><span class="n">module</span> <span class="n">moduloC</span> <span class="p">{</span>
  <span class="n">provides</span> <span class="n">interface</span> <span class="n">interfazPRB</span><span class="p">;</span>
  <span class="n">uses</span> <span class="p">{</span>
    <span class="n">interface</span> <span class="n">interfaz2</span><span class="p">;</span>
    <span class="n">interface</span> <span class="n">Leds</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">implementation</span> <span class="p">{</span>
  <span class="n">command</span> <span class="kt">void</span> <span class="n">interfazPRB</span><span class="p">.</span><span class="n">comando1</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">call</span> <span class="n">Leds</span><span class="p">.</span><span class="n">led0Toggle</span><span class="p">();</span>
    <span class="n">call</span> <span class="n">Leds</span><span class="p">.</span><span class="n">led1Toggle</span><span class="p">();</span>
    <span class="n">call</span> <span class="n">Leds</span><span class="p">.</span><span class="n">led2Toggle</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">command</span> <span class="kt">int</span> <span class="n">interfazPRB</span><span class="p">.</span><span class="n">comando2</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">call</span> <span class="n">Leds</span><span class="p">.</span><span class="n">set</span><span class="p">((</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">c</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

Cada uno de los módulos se compone de dos partes. La primera es la declaración. En ella se especifica el nombre del módulo, así como las interfaces que provee y las interfaces que usa. En el caso de <em>moduloC</em>, por ejemplo, podemos ver que la interfaz que proporciona es la interfaz <em>interfacePRB</em> y utiliza las interfaces <em>interfaz2</em> y <em>Leds</em>.
A continuación sigue la implementación. Aquí debe hacerse la implementación de cada uno de los comandos especificados en la interfaz. En éste caso no hay señales. Si las hubiese, la forma de lanzarlas es llamarlas como funciones normales (precedidas de la palabra reservada <b>signal</b>) cuando sea necesario. En éste caso, como se trata solo de un ejemplo, las funciones son totalmente triviales.

No queda mucho mas que comentar acerca de los módulos. Básicamente, después de ésto solo faltaría escribir la configuración con el <em>wiring</em> entre módulos e interfaces. ¿Y qué es eso?, pues ahora mismo lo explico.

<h2>Configuraciones</h2>

Como se ha dicho anteriormente, una aplicación escrita para <b>tinyOS</b> se compone de implementación de módulos y de configuraciones. En algunos casos, pueden hacerse aplicaciones solo con archivos de configuraciones. Un archivo de configuración consiste básicamente en un archivo formado por los módulos (o componentes) a utilizar en la aplicación y la relación que hay entre dichos módulos y las interfaces utilizadas por otros módulos.

En un principio esto puede parecer bastante lioso, así que nada mejor que verlo con algún ejemplo. Veamos primero el archivo de configuración <b>moduloEjm.nc</b>:


<div>
<div class="highlight"><pre><code class="c"><span class="n">configuration</span> <span class="n">moduloEjmC</span> <span class="p">{</span>
  <span class="n">provides</span> <span class="n">interface</span> <span class="n">interfazPRB</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">implementation</span>  <span class="p">{</span>

  <span class="n">components</span> <span class="n">LedsC</span><span class="p">;</span>
  <span class="n">components</span> <span class="n">modulo2C</span><span class="p">;</span>
  <span class="n">components</span> <span class="n">moduloC</span><span class="p">;</span>
  
  <span class="n">moduloC</span><span class="p">.</span><span class="n">Leds</span> <span class="o">-&gt;</span> <span class="n">LedsC</span><span class="p">;</span>
  <span class="n">moduloC</span><span class="p">.</span><span class="n">interfaz2</span> <span class="o">-&gt;</span> <span class="n">modulo2C</span><span class="p">;</span>

  <span class="n">interfazPRB</span> <span class="o">=</span> <span class="n">moduloC</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

Paso a paso para no liarnos: 

Lo primero que tenemos que hacer es indicar que estamos hablando de una configuración, en éste caso <em>moduloEjmC</em>. Como siempre, dicho nombre coincide con el del archivo en el que se aloja. Ésta configuración, provee una interfaz (aunque podrian ser mas), la interfaz <em>interfazPRB</em>.
En la parte de implementación vemos que utilizamos tres módulos o componentes: <em>LedsC</em>,  <em>modulo2C</em> y <em>moduloC</em>. Éstos son los módulos cuya funcionalidad necesitaremos para llevar a cabo las tareas de la configuración en la que estamos trabajando.

Después nos encontramos con la parte de <em>wiring</em>. Aquí tenemos dos conexiones:
<ul>
  <li><em>moduloC.Leds -> LedsC;</em></li>
  <li><em>moduloC.interfaz2 -> modulo2C;</em></li>
</ul>

 ¿Qué hace ésto? fácil, hemos conectado la interfaz <em>Leds</em> utilizada en la implementación del módulo <em>moduloC</em> con el componente (o módulo) <em>LedsC</em> que provee dicha interfaz y que hemos declarado anteriormente en la sección <em>components</em>. Con ésto, cada vez que invoquemos a alguno de los comando de ésta interfaz, lo que en realidad estaremos haciendo será llamar a los métodos con dicho nombre que haya implementados en el módulo <em>LedsC</em>. Si tuviésemos otro módulo con la misma interfaz, podriamos haberlo utilizado indistintamente, con la única diferencia de la implementación que esconda detrás, claro.

La segunda conexión ya queda algo mas clara, conecta el interfaz <em>interfaz2</em> de <em>moduloC</em> con el módulo <em>modulo2C</em> que provee dicha interfaz y que nosotros mismos escribimos.

Finalmente, en la última línea, podemos ver una asignación distinta a todas las vistas anteriormente. Ésta asignación lo único que hace es conectar la interfaz que se provee (<em>interfazPRB</em>) con el módulo que proveerá la funcionalidad a dicha interfaz, que en éste caso es <em>moduloC</em>.

Ahora, lo único que falta es utilizar todo ésto:


<div>
<div class="highlight"><pre><code class="c"><span class="n">configuration</span> <span class="n">ejmAppC</span><span class="p">{}</span>

<span class="n">implementation</span>
<span class="p">{</span>
  <span class="n">components</span> <span class="n">MainC</span><span class="p">,</span> <span class="n">ejmC</span><span class="p">;</span>
  <span class="n">components</span> <span class="n">moduloEjmC</span><span class="p">;</span>

  <span class="n">ejmC</span> <span class="o">-&gt;</span> <span class="n">MainC</span><span class="p">.</span><span class="n">Boot</span><span class="p">;</span>
  <span class="n">ejmC</span><span class="p">.</span><span class="n">interfazPRB</span> <span class="o">-&gt;</span> <span class="n">moduloEjmC</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

Aquí tenemos el contenido de <b>ejmAppC.nc</b>, que tiene la configuración <em>ejmAppC</em>.

Esta configuración podemos ver que no provee interfaz alguna, pero que sí usa componentes, en concreto <em>MainC</em>, <em>ejmC</em> y <em>moduloEjmC</em>. Los dos últimos son familiares ;-)

Después tenemos los <em>wirings</em>: uno que conecta la interfaz <em>Boot</em> del módulo <em>MainC</em> (utilizado para informar de que tinyOS ha arrancado y demás) con el módulo de mayor nivel de nuestra aplicación (la aplicación en si), <em>ejmC</em> y otro que conecta la interfaz <em>interfazPRB</em> que utiliza la aplicación, con el módulo (aunque lo hayamos "implementado" en un archivo de configuración, lo estamos tratando como un módulo, ya que esa configuración corresponde a la de un módulo) <em>moduloEjmC</em>.

Con ésto, ya solo nos falta implementar las funciones de nuestro programita propiamente dicho:


<div>
<div class="highlight"><pre><code class="c"><span class="n">module</span> <span class="n">ejmC</span> <span class="p">{</span>
  <span class="n">uses</span> <span class="n">interface</span> <span class="n">Boot</span><span class="p">;</span>
  <span class="n">uses</span> <span class="n">interface</span> <span class="n">interfazPRB</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">implementation</span> <span class="p">{</span>
  <span class="n">event</span> <span class="kt">void</span> <span class="n">Boot</span><span class="p">.</span><span class="n">booted</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">call</span> <span class="n">interfazPrb</span><span class="p">.</span><span class="n">comando1</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

Aquí puedes ver cómo se define un módulo llamado <em>ejmC</em> y que utiliza las interfaces <em>Boot</em> e <em>interfazPRB</em> que ya conectamos anteriormente a cada uno de los módulos que queríamos que nos diesen la funcionalidad.

A continuación, en la parte de la implementación tan solo tenemos que implementar las funciones y comandos que necesitemos para dar la funcionalidad que queramos a nuestro programita.

¿Qué por qué este es el módulo de mayor nivel? Bueno, por nada en especial. Simplemente que implementa la interfaz <em>Boot</em> del módulo <em>MainC</em>, quien lanzará el evento <em>Boot.booted</em> cuando tinyOS termine de arrancar y por tanto entregará el control del hilo principal a dicho evento, comenzando la ejecución del programa por ahí.

<h2>Referencias</h2>

<ul>
  <li>Página principal de tinyOS: <a href="http://www.tinyos.net">www.tinyos.net</a></li>
  <li>Documentación y tutoriales <em>on-line</em> acerca de tinyOS 2: <a href="http://www.tinyos.net/tinyos-2.x/doc/">www.tinyos.net/tinyos-2.x/doc/</a></li>
</ul>

      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/opinion/2007-05-09/10-razones-para-no-usar-linux" title="10 razones para no usar "Linux"">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/new/2007-05-10/libremeeting-en-miraflores-de-la-sierra-madrid" title="Libremeeting en Miraflores de la Sierra (Madrid)">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Thu Oct 10 02:38:04 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

