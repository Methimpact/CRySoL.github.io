
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Creaci√≥n de un plugin de munin para mldonkey</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#fsancho">
   fsancho
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/9fdbce59b2a9a983ec4e9cedc44e51af?s=48" alt="gravatar"/>

</span>

      </li>
      
    

    <li>created: 2009-11-28 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2009-11-28-creacin-de-un-plugin-de-munin-para-mldonkey.html">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2009-11-28-creacin-de-un-plugin-de-munin-para-mldonkey.html">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/1265">node/1265</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#shell-ref">shell</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#shell-ref">
        <img src="http://crysol.org/files/category_pictures/shell.png" title="shell" alt="shell-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalaci√≥n local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Convert .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
    <li><a href="/recipe/2013-07-10/get-shell-user-without-shell">How to get a shell for a non-shell user</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Creaci√≥n de un plugin de munin para mldonkey </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote class="head"> 
Munin es una herramienta de monitorizaci√≥n que recopila multitud de datos del sistema y los presenta en forma de gr√°ficas incrustadas en una p√°gina web. La gran virtud de munin es su extrema sencillez a la hora de instalarlo y configurarlo. Trae de serie una grand√≠sima cantidad de plugins para monitorizar casi cualquier variable del sistema.

En esta receta veremos que tambi√©n es extremadamente sencillo crear nuevos plugins para munin. Como ejemplo crearemos un plugin para monitorizar el consumo de ancho de banda de la aplicaci√≥n mldonkey.
</blockquote>

<h2> C√≥mo crear un plugin para munin </h2>
<p>
Si conocemos un poco de lenguages de script y la naturaleza de los datos que queremos monitorizar, crear un plugin para munin es algo muy sencillo.
</p>

<h3> Obtenci√≥n de los datos </h3>
<p>
Para el caso de mldonkey, utilizaremos el programa <em>mldonkey_command</em> que puede encontrarse en <em>/usr/bin</em> o bien en <em>/usr/lib/mldonkey/</em>. Este programa se conecta mediante telnet al servidor de mldonkey y ejecuta el comando que le pasemos como argumento. Para obtener los valores de velocidad de subida y descarga en ese mismo instante hay que utilizar el comando <em>bw_stats</em>. En el siguiente ejemplo veremos la salida que produce la ejecuci√≥n:</p>


<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">$</span> /usr/lib/mldonkey/mldonkey_command -p <span class="s2">&quot;password&quot;</span> bw_stats
<span class="gp">&gt;</span> bw_stats
<span class="go">Down: 11.4 KB/s ( 64 + 11592 ) | Up: 9.9 KB/s ( 17 + 10118 ) | Shared: 1118/98.95G | Downloaded: 33.7M | Uploaded: 52.1M</span>
<span class="go">MLdonkey command-line:</span>
<span class="gp">&gt;</span> 
</code></pre></div>
</div>

<p>
Los datos que queremos monitorizar est√°n ah√≠, tan solo tenemos que limpiar un poco el texto. Utilizaremos los comandos <em>grep</em> y <em>cut</em>. Por supuesto cada uno puede utilizar lo que mejor sepa usar. Estos son los filtros que usar√© para obtener cada una de las cifras:
</p>

<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">$</span> /usr/lib/mldonkey/mldonkey_command -p <span class="s2">&quot;&quot;</span> bw_stats | grep ^Down | cut -d <span class="s2">&quot;|&quot;</span> -f 1 | cut -d <span class="s2">&quot; &quot;</span> -f 2
<span class="go">11.4</span>
<span class="gp">$</span> /usr/lib/mldonkey/mldonkey_command -p <span class="s2">&quot;&quot;</span> bw_stats | grep ^Down | cut -d <span class="s2">&quot;|&quot;</span> -f 2 | cut -d <span class="s2">&quot; &quot;</span> -f 3
<span class="go">9.9</span>
</code></pre></div>
</div>

<p>
Con esto ya sabemos como obtener los datos en bruto.  Para que munin acepte estos valores tan solo tendremos que ofrec√©rselo de una forma algo estructurada. Algo as√≠:
</p>

<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;download.value &quot;</span> -n; /usr/lib/mldonkey/mldonkey_command -p <span class="s2">&quot;&quot;</span> bw_stats | grep ^Down | cut -d <span class="s2">&quot;|&quot;</span> -f 1 | cut -d <span class="s2">&quot; &quot;</span> -f 2
<span class="go">download.value 11.4</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;upload.value &quot;</span> -n ; /usr/lib/mldonkey/mldonkey_command -p <span class="s2">&quot;&quot;</span> bw_stats | grep ^Down | cut -d <span class="s2">&quot;|&quot;</span> -f 2 | cut -d <span class="s2">&quot; &quot;</span> -f 3
<span class="go">upload.value 9.9</span>
</code></pre></div>
</div>

<p>
Aqu√≠ observamos que creamos una especie de variable e invocamos su atributo valor, asign√°ndole el dato que hemos le√≠do. Ya tenemos lo complicado del script. El resto es tan solo dar formato a los datos.
</p>

<h3> La confiuraci√≥n del plugin </h3>
<p>
Para que munin sepa mas acerca de la naturaleza de los datos, as√≠ como informaci√≥n mas detallada de la representaci√≥n gr√°fica, debemos proporcionarsela en nuestro script. Munin lo hace invocando el plugin con el argumento <em>config</em>. En ese momento deberemos imprimir por pantalla las opciones de configuraci√≥n. Para nuestro plugin ser√°n las siguientes.
</p>
<tt>graph_title MLDonkey traffic</tt>: Indica que el t√≠tulo de la gr√°fica ser√° MLDonkey traffic.
<tt>graph_info This graph shows MLDonkey DL/UL rates.</tt>: Es una breve descripci√≥n de lo que representa la gr√°fica.
<tt>graph_category mldonkey</tt>: Con esto indicamos que nuestra gr√°fica estar√° en una categor√≠a llamada "mldonkey". Podr√≠amos perfectamente ubicarla dentro de la categor√≠a "Network".
<tt>graph_order upload download</tt>: Indica el orden de las variables.
<tt>graph_args -l 0 --base 1024</tt>: Indicamos que el valor m√≠nimo es 0 y que las medidas ser√°n en m√∫ltiplos de 1024.
<tt>graph_period second</tt>: Indicamos que el periodo de medici√≥n de la g≈ïafica ser√° el segundo. Eso significa que el valor en bruto que obtenemos es la velocidad medida en ese preciso instante.
<tt>graph_vlabel bytes per ${graph_period}</tt>: Esta es la etiqueta que utilizamos para indicar en que unidades se mide el eje vertical. Como se ve, medimos en bytes por segundo.

<p> Ahora, para cada una de las variables, debemos ajustar algunos par√°metros. Como se vio anteriormente, la lectura de velocidad que ofrece el servidor de mldonkey, pero nosotros queremos representarlo en bytes por segundo. Para convertir el dato no es necesario modificarlo en el script, munin lo puede hacer por nosotros. Estos son los datos de configuraci√≥n para cada variable.
</p>
<tt>download.label download speed</tt>: Esto sirve para darle un nombre descriptivo a la variable.
<tt>download.max 50000</tt>: Con esto establecemos un valor m√°ximo. 50.000 bytes por segundo parece un buen valor.
<tt>download.min 0</tt>: Este es el valor m√≠nimo que puede alcanzar la variable.
<tt>download.cdef download,1024,*</tt>: Por √∫ltimo, multiplicamos la lectura por 1024 para obtener el valor en bytes, ya que el servidor de mldonkey nos da el valor en KB, que asumiremos que se trata de KiB. 

Con la variable <em>upload</em> haremos exactamente lo mismo. Y con esto ya tenemos toda la informaci√≥n necesaria para montar nuestro plugin.

<h3> El plugin completo en un script </h3>
Tan solo nos resta meter todo lo dicho antes en un script, mas alguna cosa mas que se explicar√° posteriormente.


<div>
<div class="highlight"><pre><code class="text">#!/bin/sh

if [ &quot;$1&quot; = &quot;autoconf&quot; ]; then
    if [ -z &quot;/usr/lib/mldonkey/mldonkey_command&quot; ]; then
        echo &quot;$0: error: mldonkey_command not installed&quot;
        exit 1
     else
        echo yes
        exit 0
     fi
fi
                                                
if [ &quot;$1&quot; = &quot;config&quot; ]; then
    echo &quot;graph_title MLDonkey traffic&quot;
    echo &#39;graph_info This graph shows MLDonkey DL/UL rates.&#39;
    echo &#39;graph_category mldonkey&#39;
    echo &quot;graph_order upload download&quot;
    echo &#39;graph_vlabel bytes per ${graph_period}&#39;
    echo &#39;graph_args -l 0 --base 1024&#39;
    echo &#39;graph_period second&#39;

    echo &#39;download.label download speed&#39;
    echo &#39;download.max 50000&#39;
    echo &#39;download.min 0&#39;
    echo &#39;download.cdef download,1024,*&#39;
    
    echo &#39;upload.label upload speed&#39;
    echo &#39;upload.max 50000&#39;
    echo &#39;upload.min 0&#39;
    echo &#39;upload.cdef upload,1024,*&#39;
    exit 0
fi;

MLBW=$(/usr/lib/mldonkey/mldonkey_command -p &quot;&quot; bw_stats 2&gt; /dev/null | grep ^Down)

if [ $? -eq 0 ]; then
   DOWN=$(echo $MLBW | cut -d &quot;|&quot; -f 1 | cut -d &quot; &quot; -f 2)
   UP=$(echo $MLBW | cut -d &quot;|&quot; -f 2 | cut -d &quot; &quot; -f 3)
else
   DOWN=0;
   UP=0;
fi

echo &quot;download.value $DOWN&quot;
echo &quot;upload.value $UP&quot;
</code></pre></div>
</div>

<p>Cuando el script se invoca con el par√°metro <em>autoconf</em> el plugin comprueba que tiene todo lo necesario para ejecutarse.  En el segundo bloque viene todo lo explicado anteriormente, que no es mas que una enumeraci√≥n de todos los par√°metros de la gr√°fica. Muchos de esos valores son opcionales y no dudes en jugar con ellos hasta dar con los mas adecuados. Puedes consultar una referencia completa de todos los argumentos en [3].

Al final se ve que el plugin solo se limita a imprimir las variables con los valores de la forma que se explic√≥ al principio de la receta. 

S√≥lo nos quedar√≠a grabar el script en un fichero, darle atributos de ejecuci√≥n, grabarlo en <em>/etc/munin/plugins</em> y reiniciar el demonio <em>munin-node</em>.

<h2> Referencias </h2>

[1] <a href="http://munin.projects.linpro.no/wiki/HowToWritePlugins">How To Write Munin Plugins </a>
[2] <a href="">Plugins de munin para aMule (este plugin est√° basado en √©l) </a>
[3] <a href="thttp://munin.projects.linpro.no/wiki/protocol-config">Todos los par√°metros de una grafica</a>

      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/recipe/2009-11-28/concentrador-openvpn-en-debian-gnu-linux-o-ubuntu" title="Concentrador OpenVPN en Debian GNU/Linux (o Ubuntu)">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/new/2009-12-02/manifiesto-en-defensa-de-los-derechos-fundamentales-en-internet" title="Manifiesto en defensa de los Derechos Fundamentales en Internet">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Mon Sep 23 23:00:23 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

