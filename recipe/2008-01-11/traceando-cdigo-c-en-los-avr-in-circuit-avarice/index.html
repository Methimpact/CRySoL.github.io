
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Traceando c√≥digo C en los AVR "in circuit": avarice</title>
    
    <meta name="author" content="CRySoL">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js"></script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-narrow">
<!--
	  <a class="brand-image" href="/"><img class="brand-image" src="/assets/themes/twitter/logo.png"/></a>
-->
          <a class="brand" href="/">CRySoL</a>
          <ul class="nav">
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/recipes.html">Recipes</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/users.html">Users</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="row-fluid">
	<div class="content">
          
<div class="sidebar span3">
  <div id="logo">
  <a href="/">
    <img src="/assets/images/logo.png" alt="logo"/>
  </a>
</div>

  <div class="metadata">
  <h2>this</h2>
  <ul>
    
      <li>author: 
  <a href="/users.html#javieralso">
   javieralso
  </a>


        
        <span class="author-photo">

  <img src="http://www.gravatar.com/avatar/224f22eebba5a0b9381242cda877fbcc?s=48" alt="gravatar"/>

</span>

      </li>
      
    

    <li>created: 2008-01-11 </li>

    <li><a href="https://github.com/CRySoL/web.source/raw/master/_posts/migrated/2008-01-11-traceando-cdigo-c-en-los-avr-in-circuit-avarice.textile">source / <a href="https://github.com/CRySoL/web.source/edit/master/_posts/migrated/2008-01-11-traceando-cdigo-c-en-los-avr-in-circuit-avarice.textile">edit</a></li>

  
    <li>categories:
    
      <a href="/categories.html#recipe-ref">recipe</a>
    
    </li>
  

  
      <li>migrated&nbsp;from&nbsp;<a href="http://crysol.org/node/835">node/835</a></li>
  

  
    <li>tags:
    
      <a href="/tags.html#embedded-ref">embedded</a>
    
    </li>
  
  </ul>

  
     
     
  

  
     
     
     <a class="tag-icon" href="/tags.html#embedded-ref">
        <img src="http://crysol.org/files/category_pictures/embedded.png" title="embedded" alt="embedded-icon"/>
     </a>
     
  

  <!-- AddThis Button BEGIN -->
<div class="share addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51cdd0d57c014017"></script>
<!-- AddThis Button END -->

</div>

<div class="related">
  <h2>related</h2>
  <ul>
    
    <li><a href="/recipe/2005-09-13/ssh-y-scp-para-acceder-a-equipos-remotos-sin-escribir-la-clave-public-key-authentication">SSH y SCP para acceder a equipos remotos sin escribir la clave (public key authentication)</a></li>
    
    <li><a href="/2005-09-24/acabo-de-registrarme-en-el-portal">Acabo de registrarme en el Portal</a></li>
    
    <li><a href="/2005-09-26/buenas-a-tods">Buenas a tod@s!</a></li>
    
    <li><a href="/tale/2005-09-26/instalacin-local-de-mambo-joomla-bajo-gnu-linux">Instalaci√≥n local de Mambo / Joomla bajo GNU/Linux</a></li>
    
    <li><a href="/recipe/2005-09-27/acceso-a-red-cmpus-con-firefox-y-greasemonkey">Acceso a Red C@mpus con Firefox y Greasemonkey</a></li>
    
  </ul>
</div>

<div class="recent">
  <h2>recent</h2>
  <ul>
  
    <li><a href="/recipe/2013-09-23/virtualbox-vmdk-to-vdi">Converting .vmdk virtual disk to .vdi format from command line</a></li>
  
    <li><a href="/recipe/2013-09-19/ice35-deb-packages-from-zeroc">Installing the Ice-3.5 packages from ZeroC on Debian</a></li>
  
    <li><a href="/recipe/2013-09-03/DSO">Undertanding the DSO Link Change</a></li>
  
    <li><a href="/recipe/2013-08-11/hp-p1005-debian">HP LaserJet P1005 with Debian and the free driver</a></li>
  
    <li><a href="/recipe/2013-07-10/get-shell-user-without-shell">How to get a shell for a non-shell user</a></li>
  
  </ul>
</div>

</div>

<div class="node span9">
  <div class="page-header">
    <h1>Traceando c√≥digo C en los AVR "in circuit": avarice </h1>
  </div>

  <div class="row-fluid post-full">
    <div class="span12">
      <div class="content">
	<blockquote>C√≥mo tracear un programa en C para <span class="caps">AVR</span> en <span class="caps">GNU</span>/Linux con <b>avarice</b> &#8220;in circuit&#8221;</blockquote>
<h2>Introducci√≥n</h2>
<p>Bueno, como lo prometido es deuda he conseguido tracear un programa escrito en C para un ATMEGA128 en la propia placa de desarrollo utilizando solamente software libre. Aqu√≠ explicar√© como lo he hecho y adem√°s, como extensi√≥n a la receta anterior sobre <a href="http://crysol.org/node/833">simulaci√≥n de c√≥digo para <span class="caps">AVR</span></a> explicar√© como depurar con la herramienta libre <tt>ddd</tt>, que es b√°sicamente un <em>front-end</em> para <tt><a href="node/313">gdb</a></tt> muy f√°cil y c√≥modo de utilizar.<br />
As√≠ pues, sin mas pre√°mbulos ¬°¬°¬°¬°Al turr√≥nnnnn!!!! :-P</p>
<h2>Preparando el terreno</h2>
<p>Bueno, para nuestros prop√≥sitos neceistaremos un <a href="http://www.atmel.com/dyn/products/tools_card.asp?tool_id=2737"><em><span class="caps">AVR</span> <span class="caps">JTAG</span> <span class="caps">ICE</span></em></a>. Se trata de un programador/emulador para <em><span class="caps">AVR</span></em> y soporta much√≠simos de los micros de √©sta familia.</p>
<p>En lo referente al software, utilizaremos <a href="http://avarice.sourceforge.net/">avarice</a> que no es ni mas ni menos que nuestro interface con el <span class="caps">JTAG</span>. Tambi√©n haremos uso del ya conocido <tt>avr-gdb</tt> y de <a href="http://www.gnu.org/software/ddd/">ddd</a> como front-end de <tt>avr-gdb</tt>.</p>
<p>Bueno, pues suponiendo que seguisteis con atenci√≥n la receta anterior en la que habl√© de c√≥mo simular los <em><span class="caps">AVR</span></em>, tan solo tendremos que instalar <tt>ddd</tt> y <tt>avarice</tt> en nuestra m√°quina para empezar&#8230;</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@avalon:~$</span> sudo apt-get install avarice ddd
</code></pre></div></div>
<h2>Compilaci√≥n del c√≥digo a simular</h2>
<p>Bueno, para la compilaci√≥n del c√≥digo necesitamos exactamente las mismas opciones que para la simulaci√≥n. De hecho, el proceso es el mismo, ya que en ambos casos usamos <em>avr-gdb</em>. La √∫nica diferencia es que avarice no necesita para nada el archivo <em>.bin</em> que creamos. En su lugar utilizaremos el <em>.hex</em>, que ser√° el que carguemos en el microcontrolador para tracear. Por lo tanto podemos seguir utilizando el <em>Makefile</em> de la receta anterior y supondr√© que, de hecho, estamos trabajando con el mismo proyecto.</p>
<h2>Simulando con <em>ddd</em></h2>
<p>Bueno, antes de empezar a tracear, voy a contar como utilizar <em>ddd</em> para simular. En realidad es muy sencillo. De hecho, hay que seguir exactamente todos los pasos de la receta anterior, salvo que en lugar de llamar a <em>avr-gdbtui</em>, se llama a <em>ddd</em> dici√©ndole que use por debajo a <em>avr-gdb</em>. Resumiendo, tenemos que hacer algo como esto:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@avalon:~$</span> ddd --debugger avr-gdb -x comandos.gdb 
</code></pre></div></div>
<p>¬°¬°Y ya ta!! Ale, a simular cosas chulas :-P</p>
<h2>Un poco de <em>avarice</em></h2>
<p>Antes de ponernos manos a la obra, explicar√© un poco el uso de <em>avarice</em>. Bueno, <em>avarice</em> permite borrar, programar, cambiar los valores de los fusibles, leer el contenido de la memoria del chip, verificar el c√≥digo del chip y, por supuesto, tracear. Para todo ello necesitaremos, como es de suponer, el <span class="caps">JTAG</span> antes mencionado.</p>
<p>Si queremos hacer cosas como por ejemplo borrar un chip, har√≠amos lo siguiente:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@avalon:~$</span> avarice -2 --erase  --jtag usb
</code></pre></div></div>
<p>la opci√≥n <em>-2</em> se utiliza para decirle a <em>avarice</em> que estamos trabajando con el <span class="caps">JTAG</span> mkII, que es algo as√≠ como la segunda versi√≥n. <em>&#8212;jtag usb</em> indica que estamos utilizando la conexi√≥n <span class="caps">USB</span> del dispositivo. Si quisi√©ramos utilizar un puerto ser√≠e, habr√≠a que sustituir <em>usb</em> por la ruta del archivo de dispositivo del puerto a utilizar.</p>
<p>Para programar un micro:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@avalon:~$</span> avarice -2 --erase --program --file archivo.hex --jtag usb
</code></pre></div></div>
<p>Despu√©s de pasar la opci√≥n <em>&#8212;program</em>, tenemos que decir qu√© archivo queremos utilizar. Para se utiliza la opci√≥n <em>&#8212;file</em> seguida del archivo que queremos transferir.</p>
<p>Si se utiliza la opci√≥n <em>&#8212;P</em> seguido de un modelo de micro podemos decirle a <em>avarice</em> que estaremos utilizando √©se micro. Lo normal es que <em>avarice</em> sea capaz de leer la informaci√≥n de identificaci√≥n del micro sin problemas.</p>
<p>Siempre que queramos programar un micro, deberemos borrarlo antes de manera expl√≠cita, ya que el borrado no se hace de forma autom√°tica al iniciar la programaci√≥n, como si pasa con otros entornos.</p>
<h2>Al meollo del asunto: <span class="caps">TRACEANDO</span></h2>
<p>Ahora ha llegado la hora de la verdad. Con todo listo, nuestro <span class="caps">JTAG</span> conectado al usb del ordenador y a la tarjeta a tracear nos disponemos a empezar. La forma en que se ejecutan las aplicaciones es la misma que en la receta anterior. De hecho, para <em>avr-gdb</em>, <em>avarice</em> cumple exactamente el mismo papel que <em>simulavr</em> y lo ve de la misma manera.</p>
<p>Lanzamos primero <em>avarice</em>, dici√©ndole que programe el micro si esque no lo hab√≠amos hecho nosotros antes:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@avalon:~$</span> avarice -2 --erase --program --file rs232toRS485.hex --jtag usb:1212
</code></pre></div></div>
<p>√âsto es exactamenet lo que hicimos antes, pero con el a√±adido de que adem√°s, le hemos dicho que se quede escuchando conexiones entrantes por el puerto 1212</p>
<p>Ahora tenemos que lanzar <em>ddd</em>, pero antes necesitamos un archivo de comandos para que los ejecute al comienzo. √âste archivo es casi igual que el de la receta anterior, solo que cambian un par de cosillas, as√≠ que lo pongo tal y como lo tengo yo:</p>
<pre>
set debug remote 1
file rs232toRS485.out
target remote 192.168.0.19:1212
break main
continue
</pre>
<p>Bueno, podemos ver que el archivo es casi igual. Solo se ha eliminado el <em>load</em>, que aqu√≠ lo que hac√≠a era cargar el c√≥digo del micro en el simulador, cosa que no nos interesaba. Tambi√©n activamos la simulaci√≥n remota (<em>set debug remote 1</em>).</p>
<p>Una vez hecho √©sto, solo nos queda llamar al simulador:</p>
<div class="console">
<div class="highlight"><pre><code class="console"><span class="gp">javieralso@avalon:~$</span> ddd --debugger avr-gdb -x comandos.gdb
</code></pre></div></div>
<p>y ¬°¬°YA EST√Å!! a partir de ahora, lo que hagamos en <em>ddd</em> se ver√° reflejado en nuestra placa de desarrollo. Podremos leer variables, asignarles otros valores, etc etc etc. Eso si, existen algunas limitaciones, como por ejemplo que solo podemos tener 3 breakpoints como mucho, pero vamos, menudencias ;-)</p>
<p>Pues nada m√©s. Espero que lo disfrut√©is como lo estoy disfrutando yo y que os sea tan √∫til para vuestros proyectos como lo est√° siendo para mi ;-)</p>
<h2>Referencias</h2>
<p>?</p>
      </div>

      

      <hr/>

      <div class="pagination pagination-centered">
  <ul>
    
      <li class="prev"><a href="/quote/2008-01-11/easy-to-shoot" title="‚ÄúC makes it easy to shoot yourself in the foot; C++ makes it harder, but when you do, it blows away your whole leg‚Äù">&larr; Previous</a></li>
    

    <li><a href="/archive.html">Archive</a></li>

    
      <li class="next"><a href="/new/2008-01-15/ii-curso-online-de-java-ceslcam" title="II Curso Online de Java Ceslcam">Next &rarr;</a></li>
    
  </ul>
</div>


      <hr/>

      

<div id="show_comments"> [ <a onclick="show_comments();"> show comments </a> ] </div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'crysol'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </div>
</div>


	</div>
      </div>

      <hr/>

      <footer>
        <p>&copy; 2013 CRySoL
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
	  See <a href="https://github.com/CRySoL/CRySoL.github.io" target="_blank">site sources</a>.
	  <br/>
	  Generated at Tue Sep 24 16:30:07 +0200 2013
	</p>
      </footer>

    </div>

    
  </body>
</html>

